SQL to Extract HK stocks with multiple market instruments
=========================================================
Hi Sam,

Akhil has put together the SQL for this and I have tested in UAT1, only 5 stocks have this issue:

35587	HKG-GEM	EXMN	8289
35587	HKG-MAIN	EXMN	3899
35877	HKG-GEM	EXMN	8122
35877	HKG-MAIN	EXMN	510
55284	HKG-GEM	EXMN	8245
55284	HKG-MAIN	EXMN	814
35741	HKG-GEM	EXMN	8073
35741	HKG-MAIN	EXMN	550

Can you get someone from your team to run in PROD.

Thanks,
Geoff



SELECT S.INSTRUMENT_ID Instrument,
       A.MARKET_ID Market,
       A.ALTERNATE_TYPE AlternateType,
       A.INSTRUMENT_CODE InstrumentCode
FROM STB_INSTRUMENT S,ALT_INSTRUMENT_ID A
WHERE S.INSTRUMENT_ID = A.INSTRUMENT_ID
AND A.MARKET_ID <>'INSTRUMENT'
AND A.ALTERNATE_TYPE ='EXMN'
AND EXISTS (SELECT SI.INSTRUMENT_ID
                        FROM STB_INSTRUMENT SI,ALT_INSTRUMENT_ID AI
                        WHERE SI.INSTRUMENT_ID = AI.INSTRUMENT_ID
                        AND EXISTS(SELECT TARGET_INSTRUMENT
                                    FROM MTB_INSTRUMENT
                                    WHERE SI.INSTRUMENT_ID= TARGET_INSTRUMENT 
                                    AND TARGET_INSTRUMENT IS NOT NULL
                                    AND MARKET_ID LIKE 'HKG%'
                                    GROUP BY TARGET_INSTRUMENT
                                    HAVING COUNT(*) > 1)
                        AND S.INSTRUMENT_ID = SI.INSTRUMENT_ID
                        GROUP BY SI.INSTRUMENT_ID)

--------------------------------------------------------------------------------------------------------

Query to retrieve all the Middle Office Groups with Rights

        SELECT  USR.USER_NAME,
                USR.USER_TYPE,
                USR.DESCRIPTION,
                RGT.RIGHTS_TYPE,
                RGT.RIGHTS_CODE
        FROM STB_RIGHTS RGT RIGHT JOIN STB_USER USR
        ON RGT.USER_ID = USR.USER_ID
        WHERE USR.USER_TYPE = 'G' AND
        USR.USER_NAME like '%MIDOFF%'
        ORDER BY USR.USER_NAME


--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------


--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------


--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------


--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------


--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------


--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------


--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------


--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------



--------------------------------------------------------------------------------------------------------