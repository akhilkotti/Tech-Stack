===================================================================================================
getting constraints in sql server
===================================================================================================

USE ODIN49;
GO
SELECT OBJECT_NAME(OBJECT_ID) AS NameofConstraint,
            SCHEMA_NAME(schema_id) AS SchemaName,
            OBJECT_NAME(parent_object_id) AS TableName,
            type_desc AS ConstraintType,object_id
    FROM sys.objects
    WHERE type_desc LIKE '%CONSTRAINT'
and OBJECT_NAME(parent_object_id)='tbl_LogTrades'
order by OBJECT_NAME(parent_object_id)
GO

===================================================================================================
getting source in sql server
===================================================================================================

sp_helptext <object name>

select top 10 text from sys.syscomments where id=<sys.objects object id>

===================================================================================================
Trades and average price from ODIN
===================================================================================================

select T1.[Stock],T1.[No Of Trades],T1.[Total]/T1.[No Of Trades] "Average price(IND Rs)",
(T1.[Total]/T1.[No Of Trades])*0.023 "Average price(US $)"
from 
( 
select nOMSId "Oms Id", 
sSymbol "Stock", 
(sum(cast(nQuantityTraded as bigint)) * (avg(cast(nTradedPrice as money))/100)) "Total",
count(*) "No Of Trades" 
from tbl_LogTrades 
where convert(varchar,dCurrentTime,112) between '20080108' and '20080109' 
group by nOMSId,sSymbol
) T1 
order by T1.[Stock] 



===================================================================================================
gives the description of table
===================================================================================================

sp_columns <table name>


===================================================================================================
lists all the tables
===================================================================================================
sp_tables


===================================================================================================
table or procedure or any object structure
===================================================================================================

sp_help <table name or procedure name>


===================================================================================================
date format
===================================================================================================

select convert(varchar,getdate(),100)--Jun 25 2008  2:57PM
select convert(varchar,getdate(),101)--06/25/2008
select convert(varchar,getdate(),102)--2008.06.25
select convert(varchar,getdate(),103)--25/06/2008
select convert(varchar,getdate(),104)--25.06.2008
select convert(varchar,getdate(),105)--25-06-2008
select convert(varchar,getdate(),106)--25 Jun 2008
select convert(varchar,getdate(),107)--Jun 25, 2008
select convert(varchar,getdate(),108)--14:59:43
select convert(varchar,getdate(),109)--Jun 25 2008  2:59:43:057PM
select convert(varchar,getdate(),110)--06-25-2008
select convert(varchar,getdate(),111)--2008/06/25
select convert(varchar,getdate(),112)--20080625
select convert(varchar,getdate(),113)--25 Jun 2008 15:01:27:243
select convert(varchar,getdate(),114)--15:01:27:243


===================================================================================================

===================================================================================================

SELECT getdate(),DATEPART(hour, GETDATE()) AS 'hour'


===================================================================================================
break down of orders being worked on in 30min /w fills and average qty done per fills
===================================================================================================

------------------------------------------
--Below query is grouped by time and order
------------------------------------------
select convert(varchar,dateadd(minute,(datediff(minute,0,dCurrentTime)/30)*30,0),108) "Time",
nTradedOrderNumber "Order Number",
avg(cast(nQuantityTraded as money)) "Avg fills",
count(nQuantityTraded) "Cum fills"
from tbl_LogTrades 
where convert(varchar,dCurrentTime,112) between '20080623' and '20080623' 
group by convert(varchar,dateadd(minute,(datediff(minute,0,dCurrentTime)/30)*30,0),108),nTradedOrderNumber
order by convert(varchar,dateadd(minute,(datediff(minute,0,dCurrentTime)/30)*30,0),108)

------------------------------------------
--Below query is grouped by time and stock
------------------------------------------
select convert(varchar,dateadd(minute,(datediff(minute,0,dCurrentTime)/30)*30,0),108) "Time",
sSymbol "Stock",
avg(cast(nQuantityTraded as money)) "Avg fills",
count(nQuantityTraded) "Cum fills"
from tbl_LogTrades 
where convert(varchar,dCurrentTime,112) between '20080623' and '20080623' 
group by convert(varchar,dateadd(minute,(datediff(minute,0,dCurrentTime)/30)*30,0),108),sSymbol
order by convert(varchar,dateadd(minute,(datediff(minute,0,dCurrentTime)/30)*30,0),108)


===================================================================================================

===================================================================================================

select iob.cMappedScripCode as "Stock Code"
  from tbl_LogTrades dh, tbl_LogIOBOrders iob
 where dh.nOMSId = iob.nOMSID
and dh.dCurrentTime>= dateadd(mm,-2,getdate())
and dh.dCurrentTime < getdate()
 group by iob.cMappedScripCode


===================================================================================================

===================================================================================================




===================================================================================================

===================================================================================================




===================================================================================================

===================================================================================================





===================================================================================================

===================================================================================================





===================================================================================================

===================================================================================================





===================================================================================================

===================================================================================================





===================================================================================================

===================================================================================================





===================================================================================================

===================================================================================================





===================================================================================================

===================================================================================================





===================================================================================================

===================================================================================================





===================================================================================================

===================================================================================================





===================================================================================================

===================================================================================================





===================================================================================================

===================================================================================================





===================================================================================================

===================================================================================================




===================================================================================================

===================================================================================================




===================================================================================================

===================================================================================================




===================================================================================================

===================================================================================================




===================================================================================================

===================================================================================================




===================================================================================================

===================================================================================================




===================================================================================================

===================================================================================================