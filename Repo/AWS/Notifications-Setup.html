<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Setup Notifications (AWS)</title>

<style>
    body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #f6f8fb;
        color: #1f2937;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 1200px;
        margin: auto;
        background: #ffffff;
        padding: 32px;
    }
    h1 {
        font-size: 28px;
        border-bottom: 3px solid #2563eb;
        padding-bottom: 10px;
        margin-bottom: 24px;
    }
    h2 {
        font-size: 22px;
        margin-top: 40px;
        border-left: 5px solid #2563eb;
        padding-left: 12px;
    }
    h3 {
        font-size: 18px;
        margin-top: 28px;
        color: #0f172a;
    }
    h4 {
        font-size: 16px;
        margin-top: 20px;
        color: #1e293b;
    }
    p {
        line-height: 1.7;
        margin: 10px 0;
    }
    ul {
        margin-left: 24px;
    }
    li {
        margin: 6px 0;
    }
    code, pre {
        background: #0f172a;
        color: #e5e7eb;
        padding: 16px;
        display: block;
        border-radius: 6px;
        overflow-x: auto;
        margin: 16px 0;
        font-size: 14px;
    }
    .note {
        background: #eff6ff;
        border-left: 5px solid #2563eb;
        padding: 14px;
        margin: 20px 0;
    }
    .warning {
        background: #fff7ed;
        border-left: 5px solid #f97316;
        padding: 14px;
        margin: 20px 0;
    }
    .image-placeholder {
        background: #f1f5f9;
        border: 2px dashed #94a3b8;
        padding: 40px;
        text-align: center;
        color: #475569;
        margin: 20px 0;
        border-radius: 6px;
        font-style: italic;
    }
    .footer {
        margin-top: 50px;
        border-top: 1px solid #e5e7eb;
        padding-top: 16px;
        text-align: center;
        font-size: 13px;
        color: #6b7280;
    }
</style>
</head>

<body>
<div class="container">

<h1>SETUP NOTIFICATIONS (AWS)</h1>

<h2>1. AWS Workflow Overview</h2>
<p>Set up the AWS workflow using the following services:</p>
<ul>
    <li><strong>Lambda</strong> – Processes the messages from the SQS queue</li>
    <li><strong>SQS</strong> – Handles message queues with a notification queue and a delete queue.</li>
    <li><strong>S3</strong> – Stores HTML email templates</li>
    <li><strong>SES</strong> – Configuration of SES to send email messages</li>
    <li><strong>Elastic Beanstalk</strong> – Hosts your application that triggers the workflow</li>
</ul>

<h2>2. AWS Services</h2>

<h3>2.1 Lambda</h3>
<p>Create a Lambda function named <strong>akhil_notifications_lambda</strong>.</p>
<ul>
    <li>Set the region to <strong>eu-north-1</strong></li>
    <li>Click on create function, add function name and runtime environment as shown in screen shot. Leave all other sections to default and click on create function</li>
</ul>

<div class="image-placeholder">&lt;Add Image file1 – Lambda Creation Screen&gt;</div>

<h4>Add the below code to the newly created lambda function</h4>
<pre>
import boto3
import json

def lambda_handler(event, context):
    # Extract payload from the event
    payload = event['payload']

    print(event)

    # Initialize SQS client
    sqs = boto3.client('sqs')

    # Specify the URL of the SQS queue
    queue_url = 'https://sqs.eu-north-1.amazonaws.com/099654286395/akhil_notification_queue'

    # Send message to SQS queue
    response = sqs.send_message(
        QueueUrl=queue_url,
        MessageBody=json.dumps(payload)
    )
</pre>

<h3>2.2 Create an SQS queue</h3>
<ul>
    <li>Click on the create queue button</li>
		<ul>
			<li>Name: <strong>deadletter_queue</strong></li>
			<li>Keep the other default settings and click on create queue</li>
		</ul>
    <li>Click on create queue button</li>
		<ul>
			<li>Name: <strong>akhil_notification_queue</strong></li>
			<li>Under Dead-letter queue section, select the enabled option and assign the above dead letter que to it <strong>(deadletter_queue)</strong>. Keep other default settings and click on create queue button</li>
		</ul>	
    <li>Replace Queue URL in Lambda code</li>
</ul>

<h3>2.3 Create an S3 bucket</h3>
<ul>
    <li>Create an S3 bucket with name <strong>akhil-email-templates</strong></li>
    <li>Upload the required templates as mentioned below to S3 bucket</li>
	<ul>
		<li>assignment-approved-by-manager.html</li>
		<li>manager-initiates-swap.html</li>
		<li>professional-accepts-swap.html</li>
		<li>profile-validated.html</li>
		<li>signup.html</li>
		<li>swap-shift-approved.html</li>
	</ul>	
</ul>

<h3>2.4 Setup Amazon Simple Email Service (SES) and verify domain</h3>
<ul>
    <li>Sign in to AWS SES</strong></li>
	<ul>
		<li>Log in to the AWS Management Console</li>
		<li>Navigate to the SES Console</li>
		<li>Choose your preferred AWS region</li>
	</ul>	
	
	<li>Verify Your Domain</li>
	<ul>			
		<li>In the SES console:</li>
		<ul>
			<li>Go to the identities section under "Configuration."</li>
			<li>Click Create identity > Select Domain as the identity type</li>
			<li>Enter your domain name: akhilkotti.net</li>
		</ul>			
		<li>Choose Verification Options:</li>
		<ul>
			<li>Enable DKIM signing (recommended for improving deliverability).</li>
			<li>SES will generate DKIM CNAME records for verification.</li>
		</ul>			
		<li>Review and Create Identity:</li>
		<ul>
			<li>Click Create identity to generate DNS records for domain verification and DKIM</li>
		</ul>			
	</ul>

    <li>Update DNS Records</strong></li>
	<ul>
		<li>Go to your domain's DNS provider (Route 53).</li>
		<li>Add the records provided by SES to your DNS settings:</li>
		<ul>
			<li>TXT Record: For domain verification</li>
			<li>Append the value to the TXT record </li>
			<li>CNAME Records: For DKIM signing</li>
			<li>MX Record: If you want SES to receive inbound emails</li>
		</ul>		
	</ul>
	<table style="width:100%; border-collapse:collapse; font-family:'Segoe UI', Arial, sans-serif; font-size:14px;">
		<thead>
			<tr style="background:#f1f5f9;">
				<th style="border:1px solid #cbd5e1; padding:10px; text-align:left;">Record Name</th>
				<th style="border:1px solid #cbd5e1; padding:10px; text-align:left;">Type</th>
				<th style="border:1px solid #cbd5e1; padding:10px; text-align:left;">Value</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td style="border:1px solid #cbd5e1; padding:10px;">
					jispfkogkqg27bfb77s4nqd7se7ydksh._domainkey.akhilkotti.net
				</td>
				<td style="border:1px solid #cbd5e1; padding:10px;">CNAME</td>
				<td style="border:1px solid #cbd5e1; padding:10px;">
					<strong>jispfkogkqg27bfb77s4nqd7se7ydksh.dkim.amazonses.com</strong>
				</td>
			</tr>
			<tr>
				<td style="border:1px solid #cbd5e1; padding:10px;">
					mhgkfhj2vezh2cg7k6xhnu3lyifqnd5g._domainkey.akhilkotti.net
				</td>
				<td style="border:1px solid #cbd5e1; padding:10px;">CNAME</td>
				<td style="border:1px solid #cbd5e1; padding:10px;">
					<strong>mhgkfhj2vezh2cg7k6xhnu3lyifqnd5g.dkim.amazonses.com</strong>
				</td>
			</tr>
			<tr>
				<td style="border:1px solid #cbd5e1; padding:10px;">
					pqpe2euzcvxllha63gpdauuulyutacpy._domainkey.akhilkotti.net
				</td>
				<td style="border:1px solid #cbd5e1; padding:10px;">CNAME</td>
				<td style="border:1px solid #cbd5e1; padding:10px;">
					<strong>pqpe2euzcvxllha63gpdauuulyutacpy.dkim.amazonses.com</strong>
				</td>
			</tr>
			<tr>
				<td style="border:1px solid #cbd5e1; padding:10px;">
					info.akhilkotti.net
				</td>
				<td style="border:1px solid #cbd5e1; padding:10px;">MX</td>
				<td style="border:1px solid #cbd5e1; padding:10px;">
					<strong>10 feedback-smtp.eu-north-1.amazonses.com</strong>
				</td>
			</tr>
			<tr>
				<td style="border:1px solid #cbd5e1; padding:10px;">
					info.akhilkotti.net
				</td>
				<td style="border:1px solid #cbd5e1; padding:10px;">TXT</td>
				<td style="border:1px solid #cbd5e1; padding:10px;">
					v=spf1 <strong>include:amazonses.com</strong> ~all
				</td>
			</tr>
		</tbody>
	</table>	
    <li>Wait for Verification</strong></li>
	<ul>
		<li>SES checks your DNS records periodically</li>
		<li>Domain status will change to Verified in the SES console after successful validation</li>	
	</ul>	
    <li>Enable DMARC</strong></li>
	<ul>
		<li>Create a DMARC Policy:</li>
		<ul>
			<li>Append the dmarc value to the TXT record in DNS</li>
			<li>"v=DMARC1; p=none; rua=cd80911d@mxtoolbox.dmarc-report.com; ruf=cd80911d@forensics.dmarc-report.com; fo=1"</li>
		</ul>	
		<table style="width:100%; border-collapse:collapse; font-family:'Segoe UI', Arial, sans-serif; font-size:14px;">
			<thead>
				<tr style="background:#f1f5f9;">
					<th style="border:1px solid #cbd5e1; padding:10px; text-align:left;">Record Name</th>
					<th style="border:1px solid #cbd5e1; padding:10px; text-align:left;">Type</th>
					<th style="border:1px solid #cbd5e1; padding:10px; text-align:left;">Value</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td style="border:1px solid #cbd5e1; padding:10px;">
						akhilkotti.net
					</td>
					<td style="border:1px solid #cbd5e1; padding:10px;">TXT</td>
					<td style="border:1px solid #cbd5e1; padding:10px;">
<pre>
MS=ms26665826
v=spf1 include:secureserver.net -all
v=DMARC1; p=none; rua=cd80911d@mxtoolbox.dmarc-report.com; ruf=cd80911d@forensics.dmarc-report.com; 
fo=1
</pre>
					</td>
				</tr>
			</tbody>
		</table>
		<li>Components:</li>
		<ul>
			<li>p: Policy for emails failing DMARC (none, quarantine, reject).</li>
			<li>rua: Email address for aggregate reports</li>
			<li>ruf: Email address for forensic reports.</li>
			<li>pct: Percentage of messages subject to DMARC policy.</li>			
		</ul>			
		<li>Test Your DMARC Policy:</li>	
		<ul>
			<li>Start with p=none to monitor and validate email flows without rejecting emails</li>
			<li>Gradually move to quarantine or reject once confident.</li>	
		</ul>		
	</ul>	
    <li>Test Sending Emails</strong></li>
	<ul>
		<li>In Sandbox Mode:</li>
		<ul>
			<li>SES accounts are in sandbox mode by default. In this mode:</li>
			<ul>
				<li>You can only send emails to verified email addresses or domains</li>
				<li>Limitations on daily sending and message rates apply</li>
				<li>Verify an email address by selecting Create identity > Email address in SES. (info@akhilkotti.net)</li>
			</ul>			
		</ul>		
		<li>Move to Production Mode:</li>
		<ul>
			<li>Open a Sending Limits Increase case in the Service Quotas section of AWS:</li>
			<ul>
				<li>Go to Request Quota Increase</li>
				<li>Request to move SES out of the sandbox for your region</li>
				<li>Provide necessary details, like expected email volume and use case.</li>
			</ul>			
		</ul>		
	</ul>	
</ul>

<h3>2.5 Create a beanstalk instance - Elastic Beanstalk</h3>
<ul>
    <li>Select environment eu-north-1</li>
    <li><strong>Configure environment:</strong></li>
	<ul>
		<li>Click on Create Environment button</li>
		<ul>
			<li>Select Webserver Environment</li>
			<div class="image-placeholder">&lt;Add Image file2 – Webserver Environment&gt;</div>
			<li>Add application name as <strong>akhil_notification_service</strong></li>
			<li>Under Environment information section Environment Name will be auto populated as <strong>Akhilnotificationservice-env</strong></li>
			<div class="image-placeholder">&lt;Add Image file2 – Webserver Environment&gt;</div>
			<li>Domain will be autogenerated (Note: Don’t enter any value)</li>
			<li>Under Platform section select platform as python, platform branch as Python 3.1.2. Platform version is auto populated.</li>
			<div class="image-placeholder">&lt;Add Image file2 – Webserver Environment&gt;</div>
			<li>Under Application code section, select upload your code. Add Version label (1.1). Select Local File and upload the Zip file.</li>
			<ul>
				<li>Creating a Zipped file</li>
				<ul>
					<li>Download the notification service from the bitbucket repository</li>
					<li>Navigate to lambdas directory and create a zip file for <strong>notification_lambda</strong> with the same name.</li>
					<li>Zip the <strong>notificationService</strong> folder and upload</li>
					<div class="image-placeholder">&lt;Add Image file2 – Webserver Environment&gt;</div>
				</ul>				
			</ul>			
			<li>Click on Next button</li>
		</ul>			

	</ul>	
    <li><strong>Configure service access:</strong></li>
	<ul>
		<li>Before configuring service access navigate to IAM and create role <strong>aws-elasticbeanstalk-service-role</strong> and <strong>akhil-notification-service-role</strong></li>
		<li><strong>EBS Service Role:</strong> aws-elasticbeanstalk-service-role</li>
		<ul>
			<li>Under Access management click on Roles</li>
			<li>Trusted Entity:</li>
			<ul>
				<li>Select AWS Service.</li>
				<li>Choose the use case Elastic Beanstalk > Elastic Beanstalk Service</li>
			</ul>				
			<li>Attach Policies:</li>
			<ul>
				<li>AWSElasticBeanstalkEnhancedHealth</li>
				<li>AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy</li>
				<li>AWSElasticBeanstalkMulticontainerDocker</li>
				<li>AWSElasticBeanstalkWebTier</li>
				<li>AWSElasticBeanstalkWorkerTier</li>
			</ul>			
			<li>Name the Role:</li>
			<ul>
				<li>Name the role as <strong>aws-elasticbeanstalk-service-role</strong> and click on Create Role</li>
			</ul>			
		</ul>
		<li><strong>EC2 instance profile:</strong> akhil-notification-service-role</li>
		<ul>
			<li>Under Access management click on Roles</li>
			<li>Trusted Entity:</li>
			<ul>
				<li>Select AWS Service.</li>
				<li>Under the Use case section, select EC2</li>
			</ul>				
			<li>Attach Policies:</li>
			<ul>
				<li>AdministratorAccess-AWSElasticBeanstalk</li>
				<li>AmazonEC2FullAccess</li>
				<li>AWSElasticBeanstalkCustomPlatformforEC2Role</li>
				<li>AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy</li>
				<li>AWSElasticBeanstalkMulticontainerDocker</li>
				<li>AWSElasticBeanstalkWebTier</li>
				<li>AWSElasticBeanstalkWorkerTier</li>				
			</ul>			
			<li>Name the Role:</li>
			<ul>
				<li>Name the role as <strong>akhil-notification-service-role</strong> and click on Create Role</li>
			</ul>	
			<p>Note: IAM roles creation is complete</p>
		</ul>		
		<li>Go back to Configure service access and select Service role as use an existing service role</li>
		<ul>
			<li>Under Existing service roles Select <strong>aws-elasticbeanstalk-service-role</strong> from the auto complete drop down</li>
			<li>Under EC2 instance profile Select <strong>akhil-notification-service-role</strong> from the auto complete drop down</li>
			<div class="image-placeholder">&lt;Add Image file2 – Webserver Environment&gt;</div>
			<li>Click on Next</li>
		</ul>			
	</ul>	
	<li><strong>Set up networking, database, and tags</strong></li>
	<ul>
		<li>Click on Next</li>
	</ul>	
	<li><strong>Configure instance traffic and scaling</strong></li>
	<ul>
		<li>Go to the Capacity section</li>
		<li>Choose instance types as t3.medium, t3.small</li>
		<div class="image-placeholder">&lt;Add Image file2 – Webserver Environment&gt;</div>
		<li>Click on Next</li>
	</ul>	
	<li>Configure updates, monitoring, and logging</li>
	<ul>
		<li>Click on Next</li>
	</ul>	
	<li>Review</li>
	<ul>
		<li>Check all the configurations and Click on Submit button if ok</li>
	</ul>	
</ul>

<h4>Add the below ENV keys in the configure of the beanstalk:</h4>
<ul>
	<li>Add the below env variables to the service</li>
	<ul>
		<li>AWS_ACCESS_KEY_ID=###################</li>
		<li>AWS_SECRET_ACCESS_KEY=sdfsdfsdfds##jhjhjhfd##jhgjhjhghj</li>
		<p>Note: (above 2 keys will change post migration)</p>
		<li>AWS_DEFAULT_REGION=eu-north-1</li>
		<li>QUEUE_NAME=akhil_notification_queue</li>
		<li>EMAIL_TEMPLATE_BUCKET_NAME=akhil-email-templates</li>
		<li>TWILIO_ACCOUNT_SID=HGgjGJGJJkjkkkjKJHK</li>	
		<li>TWILIO_ACCOUNT_TOKEN=876HjkkhjjkjYUIhkhkj887HJK</li>		
	</ul>	
</ul>

<h2>3. Security Considerations</h2>
<p>IAM roles must be configured using the principle of least privilege.</p>

<h2>4. Performance Considerations</h2>
<p>TBD</p>

<div class="footer">
    ***** Confidential
</div>

</div>
</body>
</html>
