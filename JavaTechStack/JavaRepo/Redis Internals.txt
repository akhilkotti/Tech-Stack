---

# ğŸ”¥ Redis Internals â€” INTERVIEW DEEP DIVE

---

## 1ï¸âƒ£ What is Redis? (Basic â†’ Advanced)

### âœ… Basic

Redis = **REmote DIctionary Server**
An **in-memory key-value data store** used for:

* Caching
* Sessions
* Rate limiting
* Pub/Sub
* Leaderboards

---

### ğŸš€ Advanced

Redis is:

* **Single-threaded event loop** (by design)
* **In-memory first**, disk persistence optional
* **Extremely fast** (sub-millisecond latency)
* Uses **non-blocking I/O (epoll)**

ğŸ“Œ Why single-threaded?

> Avoids locks â†’ predictable latency â†’ high throughput

---

## 2ï¸âƒ£ Redis Data Structures (INTERVIEW FAVORITE)

| Redis Type  | Java Equivalent | Use Case      |
| ----------- | --------------- | ------------- |
| String      | String          | Cache values  |
| Hash        | Map             | User sessions |
| List        | Deque           | Queues        |
| Set         | Set             | Deduplication |
| Sorted Set  | TreeSet         | Leaderboards  |
| Bitmap      | BitSet          | Feature flags |
| HyperLogLog | Approx set      | Unique counts |

---

### Example

```bash
SET user:1 "Akhil"
HSET session:123 userId 1 role ADMIN
```

---

## 3ï¸âƒ£ Redis Architecture (VERY IMPORTANT)

### Core Components

```
Client
  â†“
Event Loop (epoll)
  â†“
In-Memory Data Store
  â†“
Persistence (Optional)
```

---

### Key Internals

* Event loop (single thread)
* Command queue
* Memory allocator (jemalloc)
* Expiry dictionary (TTL)

---

## 4ï¸âƒ£ Redis Persistence (AOF vs RDB)

### ğŸ”¹ RDB (Snapshot)

* Periodic snapshots
* Fast restart
* Possible data loss

```bash
save 900 1
```

---

### ğŸ”¹ AOF (Append Only File)

* Logs every write
* Safer
* Slower

```bash
appendonly yes
```

---

### ğŸ”¹ Interview Tip

> **Production** usually uses **AOF + RDB hybrid**

---

## 5ï¸âƒ£ Redis Replication & Clustering

### Replication

* One master
* Multiple replicas
* Async replication

---

### Redis Cluster

* Sharding using **hash slots (16384)**
* Horizontal scaling
* No single point of failure

---

## 6ï¸âƒ£ Redis Expiry & Eviction (IMPORTANT)

### TTL

```bash
SET key value EX 60
```

---

### Eviction Policies

| Policy     | Meaning               |
| ---------- | --------------------- |
| LRU        | Least Recently Used   |
| LFU        | Least Frequently Used |
| noeviction | Error                 |

ğŸ“Œ **Interview Tip**

> Redis does NOT evict randomly by default.

---

## 7ï¸âƒ£ Why Redis is Perfect for Rate Limiting

âœ” Atomic operations
âœ” Single-threaded â†’ no race condition
âœ” TTL support
âœ” Extremely fast

---

# ğŸš¦ RATE LIMITER USING REDIS (REAL-TIME DESIGN)

---

## 1ï¸âƒ£ Problem Statement

Limit:

* **100 requests per minute per IP**

---

## 2ï¸âƒ£ Approach Options (Interview Expectations)

| Strategy       | Accuracy  | Complexity |
| -------------- | --------- | ---------- |
| Fixed Window   | Low       | Easy       |
| Sliding Window | High      | Medium     |
| Token Bucket   | Very High | Hard       |
| Leaky Bucket   | High      | Hard       |

ğŸ‘‰ **Most interviews expect Sliding Window or Token Bucket**

---

## 3ï¸âƒ£ Fixed Window (EASY â€” Explain Quickly)

### Idea

* Count requests per minute
* Reset every minute

---

### Redis Commands

```bash
INCR rate:ip
EXPIRE rate:ip 60
```

---

### Java Code

```java
Long count = redis.incr(key);
if (count == 1) {
    redis.expire(key, 60);
}

if (count > 100) {
    reject();
}
```

---

### âŒ Drawback

Burst at boundary (59s + 1s issue)

---

## 4ï¸âƒ£ Sliding Window (INTERVIEW FAVORITE)

---

### Concept

Track timestamps of requests.

---

### Redis Data Structure

**Sorted Set (ZSET)**

---

### Redis Logic

```bash
ZADD rate:ip timestamp timestamp
ZREMRANGEBYSCORE rate:ip 0 (now - window)
ZCARD rate:ip
```

---

### Java (Spring Boot) Example

```java
String key = "rate:" + ip;
long now = System.currentTimeMillis();

redisTemplate.opsForZSet().add(key, now, now);
redisTemplate.opsForZSet()
             .removeRangeByScore(key, 0, now - 60000);

Long count = redisTemplate.opsForZSet().zCard(key);

if (count > 100) {
    throw new RateLimitException();
}
```

---

### ğŸ¯ Why this is good

âœ” Accurate
âœ” Smooth rate limiting
âœ” Industry standard

---

## 5ï¸âƒ£ Token Bucket (ADVANCED / SENIOR)

---

### Concept

* Bucket has tokens
* Requests consume tokens
* Tokens refill over time

---

### Redis + Lua (Atomicity)

```lua
local tokens = redis.call("GET", KEYS[1])
-- logic here
```

---

### Why Lua?

âœ” Atomic execution
âœ” No race conditions
âœ” Single Redis call

ğŸ“Œ **INTERVIEW GOLD**

> â€œWe use Lua scripts in Redis to ensure atomic rate limiting.â€

---

## 6ï¸âƒ£ Redis Atomicity (VERY IMPORTANT)

Redis guarantees:

* **Single command atomicity**
* Lua scripts are **fully atomic**

So:

```bash
INCR + EXPIRE
```

is safe when used correctly.

---

## 7ï¸âƒ£ Common Interview Traps

### â“ Why not DB-based rate limiting?

âŒ Slow
âŒ Lock contention
âŒ Poor scalability

---

### â“ Why not in-memory map?

âŒ Not shared across pods

---

### â“ Why Redis over Kafka?

âœ” Immediate response
âœ” Low latency

---

## 8ï¸âƒ£ Production Best Practices

### âœ… Doâ€™s

âœ” Use Redis Cluster
âœ” Use TTL
âœ” Use Lua for atomic logic
âœ” Monitor memory

### âŒ Donâ€™ts

âŒ Hard-code limits
âŒ Forget eviction policy
âŒ Store large payloads

---

## ğŸ¯ PERFECT INTERVIEW ANSWER (FINAL)

> â€œRedis is an in-memory, single-threaded data store optimized for fast atomic operations. It is ideal for rate limiting using counters or sorted sets. For accurate rate limiting, sliding window or token bucket algorithms implemented with Redis and Lua scripts are used.â€

---

## ğŸš€ Want Next?

* Redis Lua scripts deep dive
* Spring Boot Redis configuration
* Distributed locking using Redis
* Circuit breaker using Redis
* Cache consistency strategies

Just tell me ğŸ‘
