<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AWS Microservices ‚Äì End-to-End Architecture Guide</title>

<style>
:root {
  --bg: #f6f8fb;
  --left-bg: #111827;
  --left-hover: #1f2937;
  --primary: #2563eb;
  --text: #111827;
  --muted: #6b7280;
  --code-bg: #0f172a;
  --code-text: #e5e7eb;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: var(--bg);
  color: var(--text);
}

.container {
  display: flex;
  height: 100vh;
}

/* LEFT PANE */
.left {
  width: 30%;
  background: var(--left-bg);
  color: #fff;
  padding: 18px;
  overflow-y: auto;
}

.left h2 {
  font-size: 18px;
  margin-bottom: 14px;
  color: #93c5fd;
}

.menu {
  list-style: none;
  padding: 0;
  margin: 0;
}

.menu li {
  padding: 10px 12px;
  margin-bottom: 6px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
}

.menu li:hover {
  background: var(--left-hover);
}

.menu li.active {
  background: var(--primary);
}

/* RIGHT PANE */
.right {
  width: 70%;
  padding: 28px;
  background: #ffffff;
  overflow-y: auto;
}

.right h2 {
  margin-top: 0;
  color: #1f2937;
}

.right p {
  line-height: 1.6;
  color: #1f2937;
}

.right ul, .right ol {
  margin-left: 20px;
  line-height: 1.6;
}

.right li {
  margin-bottom: 6px;
}

/* CODE BLOCKS */
pre {
  background: var(--code-bg);
  color: var(--code-text);
  padding: 14px;
  border-radius: 8px;
  overflow-x: auto;
  font-size: 13px;
}

code {
  font-family: Consolas, monospace;
  color: #93c5fd;
}

.runtime-box {
  background: #0b1220;
  padding: 20px;
  border-radius: 12px;
  color: #9fe0ff;
  font-family: monospace;
}

.runtime-box ul {
  list-style: none;
  padding-left: 0;
}

.runtime-box li::before {
  content: "‚Üí ";
  color: #4da3ff;
}

</style>
</head>

<body>

<div class="container">

  <!-- LEFT FRAME -->
  <div class="left">
    <h2>AWS Microservices Guide</h2>
    <ul class="menu">
      <li class="active" onclick="load('arch')">1. High-Level Architecture</li>
      <li onclick="load('flow')">2. Step-by-Step Request Flow(From Client to DB)</li>
      <li onclick="load('security')">3. Order Service ‚Äì Spring Security</li>
	  <li onclick="load('validation')">3.1 Signature validation, Issuer verification, Expiration check and Role-based authorization</li>
	  <li onclick="load('security2')">3.2 JwtAuthenticationConverter, 401 vs 403, token propagation between services and method-level security with @PreAuthorize</li>
	  <li onclick="load('security3')">3.3 Order Service with Security using Spring Boot 3 + JWT (Cognito-style) + Method-Level Security</li>
      <li onclick="load('sync')">4. Synchronous ‚Äì FEIGN + JWT TOKEN PROPAGATION</li>
      <li onclick="load('async')">5. Asynchronous ‚Äì AWS SQS WITH RETRY + DLQ</li>
      <li onclick="load('kafka')">6. EVENT-DRIVEN ARCHITECTURE (KAFKA)</li>
      <li onclick="load('testing')">7. JUnit & Mockito Testing</li>
      <li onclick="load('cognito')">8. Cognito Password Validation</li>
      <li onclick="load('summary')">9. Final Summary</li>
    </ul>
  </div>

  <!-- RIGHT FRAME -->
  <div class="right" id="content"></div>

</div>

<script>
const data = {

arch: `
<h2>1. High-Level Architecture</h2>
<p>
This system represents a real-world, enterprise-grade AWS microservices architecture
secured using OAuth2 and JWT.
</p>
<h2>Actors &amp; Components</h2>

<ul>
  <li>Client (React / Mobile App).Client authenticates using Amazon Cognito</li>

  <li><strong>Amazon Cognito</strong> (OAuth2 Authorization Server).Cognito issues OAuth2 JWT tokens</li>

  <li><strong>Amazon API Gateway.</strong>API Gateway validates JWT before routing</li>

  <li><strong>Application Load Balancer.</strong>ALB routes traffic to Spring Boot microservices</li>

  <li><strong>Spring Boot Microservices.</strong>Each microservice re-validates JWT (Zero Trust)
    <ul>
      <li>Order Service</li>
      <li>Payment Service</li>
    </ul>
  </li>

  <li><strong>Services communicate using Feign, SQS, and Kafka</strong>
    <ul>
      <li><strong>Amazon SQS</strong></li>
      <li><strong>Apache Kafka</strong></li>
    </ul>  
  </li>
  <li>CloudWatch + X-Ray (provide Observability)</li>
</ul>
`,

flow: `
<h2>2. Step-by-Step Request Flow (Client ‚Üí DB)</h2>
<pre><code>
User logs in via Cognito (OAuth2)
Cognito validates password & MFA (if enabled)
JWT is issued to the client
Client sends request with Authorization header
API Gateway validates JWT signature & expiry
Request forwarded to ALB
ALB routes request to Order Service
Order Service validates JWT again
Business logic executes
Order Service calls Payment Service
Response travels back via same gateway path

</code></pre>

<h2>STEP 1: User Authentication (OAuth2 via Cognito)</h2>

<h3>What Happens</h3>
<ol>
  <li>User logs in (username + password)</li>
  <li>Client calls Cognito Hosted UI / Auth API</li>
  <li>Cognito:
    <ul>
      <li>Validates password policy</li>
      <li>Verifies user status</li>
      <li>Issues JWT tokens</li>
    </ul>
  </li>
</ol>

<h3>Password Validation (Cognito)</h3>
<p>Cognito enforces:</p>
<ul>
  <li>Minimum length (default 8)</li>
  <li>Uppercase, lowercase, number, special char</li>
  <li>Password history &amp; expiration (optional)</li>
  <li>MFA (optional)</li>
</ul>

<p>üëâ <strong>No password ever reaches your backend</strong></p>

<h3>Sample Login (OAuth2 Password / Auth Code Flow)</h3>

<pre><code>
POST /oauth2/token
Host: your-domain.auth.ap-south-1.amazoncognito.com
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code
&client_id=abc123
&code=AUTH_CODE
&redirect_uri=https://app.example.com/callback
</code></pre>

<h3>Cognito JWT Response</h3>

<pre><code>
{
  "access_token": "eyJraWQiOiJLT1...",
  "id_token": "eyJhbGciOiJSUzI1NiIs...",
  "expires_in": 3600,
  "token_type": "Bearer"
}
</code></pre>

<hr>

<h2>STEP 2: Client Calls API Gateway</h2>

<pre><code>
POST /orders
Authorization: Bearer &lt;access_token&gt;
</code></pre>

<h3>API Gateway Responsibilities</h3>
<ul>
  <li>‚úÖ JWT signature validation</li>
  <li>‚úÖ Token expiration check</li>
  <li>‚úÖ Issuer &amp; audience validation</li>
  <li>‚ùå Rejects invalid tokens (401)</li>
</ul>

<p>üëâ <strong>No business logic here</strong></p>

<hr>

<h2>STEP 3: API Gateway ‚Üí ALB ‚Üí Order Service</h2>

<p>Once validated:</p>
<ul>
  <li>API Gateway forwards request to ALB</li>
  <li>ALB routes <code>/orders/**</code> ‚Üí Order Service</li>
</ul>
`,

security: `
<h2>3. Order Service ‚Äì Spring Boot Security Setup</h2>

<p>
üîê <strong>JWT Validation in Microservice</strong>
</p>

<p>
Even though API Gateway validates JWT, microservices MUST revalidate
(zero-trust model).
</p>

<h3>Spring Security Config</h3>

<pre><code>
@EnableWebSecurity
public class SecurityConfig {

  @Bean
  SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http
      .authorizeHttpRequests(auth -> auth
        .requestMatchers("/orders/**").hasRole("USER")
        .anyRequest().authenticated()
      )
      .oauth2ResourceServer(oauth ->
        oauth.jwt(jwt -> jwt
          .jwtAuthenticationConverter(jwtAuthConverter())
        )
      );
    return http.build();
  }
}
</code></pre>

<h3>Cognito JWT Decoder</h3>

<pre><code>
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: https://cognito-idp.ap-south-1.amazonaws.com/ap-south-1_xxxx
</code></pre>
`,

validation: `
<hr data-start="3991" data-end="3994">
<h2 data-start="3996" data-end="4029">üéØ Interview-Perfect One-Liner</h2>
<blockquote data-start="4031" data-end="4331">
<p data-start="4033" data-end="4331">‚ÄúIn my Spring Boot microservices, JWT signature, issuer, and expiration are automatically validated by Spring Security‚Äôs OAuth2 Resource Server using Cognito‚Äôs public keys, while role-based authorization is enforced via <code data-start="4253" data-end="4264">hasRole()</code> after converting Cognito groups into Spring Security authorities.‚Äù</p>
</blockquote>
<hr data-start="4333" data-end="4336">
<ul>
  <li>Signature validation</li>
  <li>Issuer verification</li>
  <li>Expiration check</li>
  <li>Role-based authorization</li>
</ul>

<div class="flex w-full flex-col gap-1 empty:hidden first:pt-[1px]"><div class="markdown prose dark:prose-invert w-full break-words light markdown-new-styling">
<hr data-start="274" data-end="277">
<h2 data-start="279" data-end="310">1Ô∏è‚É£ Signature Validation ‚úÖ</h2>
<p data-start="311" data-end="383"><strong data-start="311" data-end="383">‚ÄúIs this JWT really issued by AWS Cognito, or was it tampered with?‚Äù</strong></p>
<h3 data-start="385" data-end="408">üîé Where it happens</h3>
<pre class="overflow-visible! px-0!" data-start="409" data-end="570"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">yaml</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-yaml"><span><span><span class="hljs-attr">spring:</span></span><span>
  </span><span><span class="hljs-attr">security:</span></span><span>
    </span><span><span class="hljs-attr">oauth2:</span></span><span>
      </span><span><span class="hljs-attr">resourceserver:</span></span><span>
        </span><span><span class="hljs-attr">jwt:</span></span><span>
          </span><span><span class="hljs-attr">issuer-uri:</span></span><span> </span><span><span class="hljs-string">https://cognito-idp.ap-south-1.amazonaws.com/ap-south-1_xxxx</span></span><span>
</span></span></code></div></div></pre>
<h3 data-start="572" data-end="615">üß† What Spring Security does internally</h3>
<p data-start="616" data-end="644">When a request arrives with:</p>
<pre class="overflow-visible! px-0!" data-start="645" data-end="702"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">http</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-http"><span>Authorization: Bearer eyJhbGciOiJSUzI1NiIs...
</span></code></div></div></pre>
<p data-start="704" data-end="716">Spring Boot:</p>
<ol data-start="717" data-end="810">
<li data-start="717" data-end="740">
<p data-start="720" data-end="740">Reads the JWT header</p>
</li>
<li data-start="741" data-end="762">
<p data-start="744" data-end="762">Sees <code data-start="749" data-end="762">alg = RS256</code></p>
</li>
<li data-start="763" data-end="810">
<p data-start="766" data-end="810">Fetches <strong data-start="774" data-end="804">Cognito public keys (JWKS)</strong> from:</p>
</li>
</ol>
<pre class="overflow-visible! px-0!" data-start="811" data-end="901"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">bash</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span>https://cognito-idp.ap-south-1.amazonaws.com/ap-south-1_xxxx/.well-known/jwks.json
</span></span></code></div></div></pre>
<ol start="4" data-start="902" data-end="952">
<li data-start="902" data-end="952">
<p data-start="905" data-end="952">Uses the public key to <strong data-start="928" data-end="952">verify the signature</strong></p>
</li>
</ol>
<h3 data-start="954" data-end="983">‚ùå If signature is invalid</h3>
<ul data-start="984" data-end="1033">
<li data-start="984" data-end="1003">
<p data-start="986" data-end="1003">Token was altered</p>
</li>
<li data-start="1004" data-end="1033">
<p data-start="1006" data-end="1033">Token issued by fake issuer</p>
</li>
</ul>
<p data-start="1035" data-end="1070">‚û°Ô∏è <strong data-start="1038" data-end="1070">Request rejected immediately</strong></p>
<pre class="overflow-visible! px-0!" data-start="1071" data-end="1099"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">http</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-http"><span>401 Unauthorized
</span></code></div></div></pre>
<p data-start="1101" data-end="1171">üìå <strong data-start="1104" data-end="1139">You did NOT write code for this</strong> ‚Äî Spring does it automatically.</p>
<hr data-start="1173" data-end="1176">
<h2 data-start="1178" data-end="1210">2Ô∏è‚É£ Issuer Verification üè∑Ô∏è</h2>
<p data-start="1211" data-end="1265"><strong data-start="1211" data-end="1265">‚ÄúWas this token issued by <em data-start="1239" data-end="1243">my</em> Cognito User Pool?‚Äù</strong></p>
<h3 data-start="1267" data-end="1290">üîé Where it happens</h3>
<pre class="overflow-visible! px-0!" data-start="1291" data-end="1375"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">yaml</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-yaml"><span><span><span class="hljs-attr">issuer-uri:</span></span><span> </span><span><span class="hljs-string">https://cognito-idp.ap-south-1.amazonaws.com/ap-south-1_xxxx</span></span><span>
</span></span></code></div></div></pre>
<h3 data-start="1377" data-end="1402">üß† What Spring checks</h3>
<p data-start="1403" data-end="1424">JWT payload contains:</p>
<pre class="overflow-visible! px-0!" data-start="1425" data-end="1512"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">json</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-json"><span><span><span class="hljs-punctuation">{</span></span><span>
  </span><span><span class="hljs-attr">"iss"</span></span><span><span class="hljs-punctuation">:</span></span><span> </span><span><span class="hljs-string">"https://cognito-idp.ap-south-1.amazonaws.com/ap-south-1_xxxx"</span></span><span>
</span><span><span class="hljs-punctuation">}</span></span><span>
</span></span></code></div></div></pre>
<p data-start="1514" data-end="1530">Spring compares:</p>
<ul data-start="1531" data-end="1578">
<li data-start="1531" data-end="1553">
<p data-start="1533" data-end="1553"><code data-start="1533" data-end="1538">iss</code> claim in token</p>
</li>
<li data-start="1554" data-end="1578">
<p data-start="1556" data-end="1578"><code data-start="1556" data-end="1568">issuer-uri</code> in config</p>
</li>
</ul>
<h3 data-start="1580" data-end="1610">‚ùå If issuer does NOT match</h3>
<p data-start="1611" data-end="1619">Example:</p>
<ul data-start="1620" data-end="1712">
<li data-start="1620" data-end="1653">
<p data-start="1622" data-end="1653">Token from another Cognito pool</p>
</li>
<li data-start="1654" data-end="1679">
<p data-start="1656" data-end="1679">Token from Auth0 / Okta</p>
</li>
<li data-start="1680" data-end="1712">
<p data-start="1682" data-end="1712">Token from another AWS account</p>
</li>
</ul>
<p data-start="1714" data-end="1729">‚û°Ô∏è <strong data-start="1717" data-end="1729">Rejected</strong></p>
<pre class="overflow-visible! px-0!" data-start="1730" data-end="1758"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">http</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-http"><span>401 Unauthorized
</span></code></div></div></pre>
<p data-start="1760" data-end="1822">üìå This prevents <strong data-start="1777" data-end="1801">token replay attacks</strong> across environments.</p>
<hr data-start="1824" data-end="1827">
<h2 data-start="1829" data-end="1856">3Ô∏è‚É£ Expiration Check ‚è∞</h2>
<p data-start="1857" data-end="1908"><strong data-start="1857" data-end="1908">‚ÄúIs this token still valid, or has it expired?‚Äù</strong></p>
<h3 data-start="1910" data-end="1933">üîé Where it happens</h3>
<p data-start="1934" data-end="1968">Automatically during JWT decoding.</p>
<p data-start="1970" data-end="1983">JWT contains:</p>
<pre class="overflow-visible! px-0!" data-start="1984" data-end="2019"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">json</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-json"><span><span><span class="hljs-punctuation">{</span></span><span>
  </span><span><span class="hljs-attr">"exp"</span></span><span><span class="hljs-punctuation">:</span></span><span> </span><span><span class="hljs-number">1735689600</span></span><span>
</span><span><span class="hljs-punctuation">}</span></span><span>
</span></span></code></div></div></pre>
<p data-start="2021" data-end="2028">Spring:</p>
<ul data-start="2029" data-end="2070">
<li data-start="2029" data-end="2070">
<p data-start="2031" data-end="2070">Compares <code data-start="2040" data-end="2045">exp</code> with current system time</p>
</li>
</ul>
<h3 data-start="2072" data-end="2097">‚ùå If token is expired</h3>
<p data-start="2098" data-end="2124">‚û°Ô∏è Spring Security throws:</p>
<pre class="overflow-visible! px-0!" data-start="2125" data-end="2168"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">makefile</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span><span class="hljs-section">JwtValidationException: Jwt expired</span></span><span>
</span></span></code></div></div></pre>
<p data-start="2170" data-end="2179">Response:</p>
<pre class="overflow-visible! px-0!" data-start="2180" data-end="2208"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">http</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-http"><span>401 Unauthorized
</span></code></div></div></pre>
<p data-start="2210" data-end="2279">üìå You don‚Äôt check <code data-start="2229" data-end="2234">exp</code> manually ‚Äî <strong data-start="2246" data-end="2278">Spring does it automatically</strong>.</p>
<hr data-start="2281" data-end="2284">
<h2 data-start="2286" data-end="2322">4Ô∏è‚É£ Role-Based Authorization üîê</h2>
<p data-start="2323" data-end="2387"><strong data-start="2323" data-end="2387">‚ÄúIs this authenticated user allowed to access <code data-start="2371" data-end="2383">/orders/**</code>?‚Äù</strong></p>
<p data-start="2389" data-end="2443">This is the <strong data-start="2401" data-end="2440">ONLY part you explicitly configured</strong> üëá</p>
<hr data-start="2445" data-end="2448">
<h3 data-start="2450" data-end="2489">üîé Where it happens (Authorization)</h3>
<pre class="overflow-visible! px-0!" data-start="2490" data-end="2620"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span>.authorizeHttpRequests(auth -&gt; auth
  .requestMatchers(</span><span><span class="hljs-string">"/orders/**"</span></span><span>).hasRole(</span><span><span class="hljs-string">"USER"</span></span><span>)
  .anyRequest().authenticated()
)
</span></span></code></div></div></pre>
<h3 data-start="2622" data-end="2652">üß† How roles are extracted</h3>
<p data-start="2653" data-end="2678">JWT payload from Cognito:</p>
<pre class="overflow-visible! px-0!" data-start="2679" data-end="2732"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">json</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-json"><span><span><span class="hljs-punctuation">{</span></span><span>
  </span><span><span class="hljs-attr">"cognito:groups"</span></span><span><span class="hljs-punctuation">:</span></span><span> </span><span><span class="hljs-punctuation">[</span></span><span><span class="hljs-string">"USER"</span></span><span><span class="hljs-punctuation">,</span></span><span> </span><span><span class="hljs-string">"ADMIN"</span></span><span><span class="hljs-punctuation">]</span></span><span>
</span><span><span class="hljs-punctuation">}</span></span><span>
</span></span></code></div></div></pre>
<p data-start="2734" data-end="2756">Your custom converter:</p>
<pre class="overflow-visible! px-0!" data-start="2757" data-end="2816"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span>.jwtAuthenticationConverter(jwtAuthConverter())
</span></span></code></div></div></pre>
<p data-start="2818" data-end="2833">This converter:</p>
<ul data-start="2834" data-end="2878">
<li data-start="2834" data-end="2858">
<p data-start="2836" data-end="2858">Reads <code data-start="2842" data-end="2858">cognito:groups</code></p>
</li>
<li data-start="2859" data-end="2878">
<p data-start="2861" data-end="2878">Converts them to:</p>
</li>
</ul>
<pre class="overflow-visible! px-0!" data-start="2879" data-end="2911"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span>ROLE_USER
ROLE_ADMIN
</span></span></code></div></div></pre>
<p data-start="2913" data-end="2935">Spring then evaluates:</p>
<pre class="overflow-visible! px-0!" data-start="2936" data-end="2963"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span>hasRole(</span><span><span class="hljs-string">"USER"</span></span><span>)
</span></span></code></div></div></pre>
<hr data-start="2965" data-end="2968">
<h3 data-start="2970" data-end="2994">‚ùå If role is missing</h3>
<p data-start="2995" data-end="3032">Token is valid, but role not allowed:</p>
<p data-start="3034" data-end="3054">‚û°Ô∏è <strong data-start="3037" data-end="3054">403 Forbidden</strong></p>
<pre class="overflow-visible! px-0!" data-start="3055" data-end="3097"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">json</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-json"><span><span><span class="hljs-punctuation">{</span></span><span>
  </span><span><span class="hljs-attr">"error"</span></span><span><span class="hljs-punctuation">:</span></span><span> </span><span><span class="hljs-string">"Access Denied"</span></span><span>
</span><span><span class="hljs-punctuation">}</span></span><span>
</span></span></code></div></div></pre>
<p data-start="3099" data-end="3128">üìå Important interview point:</p>
<blockquote data-start="3129" data-end="3199">
<p data-start="3131" data-end="3199"><strong data-start="3131" data-end="3163">401 = authentication failure</strong><br data-start="3163" data-end="3166">
<strong data-start="3168" data-end="3199">403 = authorization failure</strong></p>
</blockquote>
<hr data-start="3201" data-end="3204">
<h2 data-start="3206" data-end="3244">üîÅ END-TO-END FLOW (VERY IMPORTANT)</h2>
<h3 data-start="3246" data-end="3278">Request enters Order Service</h3>
<pre class="overflow-visible! px-0!" data-start="3279" data-end="3312"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">makefile</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span><span class="hljs-section">Authorization: Bearer JWT</span></span><span>
</span></span></code></div></div></pre>
<p data-start="3314" data-end="3363">Spring Security executes <strong data-start="3339" data-end="3362">in this exact order</strong>:</p>
<div class="TyagGW_tableContainer"><div tabindex="-1" class="group TyagGW_tableWrapper flex w-fit flex-col-reverse"><table data-start="3365" data-end="3634" class="w-fit min-w-(--thread-content-width)"><thead data-start="3365" data-end="3400"><tr data-start="3365" data-end="3400"><th data-start="3365" data-end="3372" data-col-size="sm">Step</th><th data-start="3372" data-end="3380" data-col-size="sm">Check</th><th data-start="3380" data-end="3400" data-col-size="sm">Result if Failed</th></tr></thead><tbody data-start="3418" data-end="3634"><tr data-start="3418" data-end="3452"><td data-start="3418" data-end="3422" data-col-size="sm">1</td><td data-col-size="sm" data-start="3422" data-end="3445">Signature validation</td><td data-col-size="sm" data-start="3445" data-end="3452">401</td></tr><tr data-start="3453" data-end="3486"><td data-start="3453" data-end="3457" data-col-size="sm">2</td><td data-start="3457" data-end="3479" data-col-size="sm">Issuer verification</td><td data-col-size="sm" data-start="3479" data-end="3486">401</td></tr><tr data-start="3487" data-end="3517"><td data-start="3487" data-end="3491" data-col-size="sm">3</td><td data-col-size="sm" data-start="3491" data-end="3510">Expiration check</td><td data-col-size="sm" data-start="3510" data-end="3517">401</td></tr><tr data-start="3518" data-end="3556"><td data-start="3518" data-end="3522" data-col-size="sm">4</td><td data-col-size="sm" data-start="3522" data-end="3549">Token structure &amp; claims</td><td data-col-size="sm" data-start="3549" data-end="3556">401</td></tr><tr data-start="3557" data-end="3595"><td data-start="3557" data-end="3561" data-col-size="sm">5</td><td data-start="3561" data-end="3588" data-col-size="sm">Role-based authorization</td><td data-col-size="sm" data-start="3588" data-end="3595">403</td></tr><tr data-start="3596" data-end="3634"><td data-start="3596" data-end="3600" data-col-size="sm">6</td><td data-col-size="sm" data-start="3600" data-end="3629">Controller method executed</td><td data-col-size="sm" data-start="3629" data-end="3634">‚úÖ</td></tr></tbody></table><div class="sticky h-0 select-none end-(--thread-content-margin) self-end"><div class="absolute end-0 flex items-end" style="height: 33px;"><span class="" data-state="closed"><button aria-label="Copy table" class="hover:bg-token-bg-tertiary text-token-text-secondary my-1 rounded-sm p-1 transition-opacity group-[:not(:hover):not(:focus-within)]:pointer-events-none group-[:not(:hover):not(:focus-within)]:opacity-0"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg></button></span></div></div></div></div>
<hr data-start="3636" data-end="3639">
<h2 data-start="3641" data-end="3674">üß† Who does what (Quick Table)</h2>
<div class="TyagGW_tableContainer"><div tabindex="-1" class="group TyagGW_tableWrapper flex w-fit flex-col-reverse"><table data-start="3676" data-end="3989" class="w-fit min-w-(--thread-content-width)"><thead data-start="3676" data-end="3712"><tr data-start="3676" data-end="3712"><th data-start="3676" data-end="3694" data-col-size="sm">Security Aspect</th><th data-start="3694" data-end="3712" data-col-size="sm">Who Handles It</th></tr></thead><tbody data-start="3723" data-end="3989"><tr data-start="3723" data-end="3778"><td data-start="3723" data-end="3746" data-col-size="sm">Signature validation</td><td data-col-size="sm" data-start="3746" data-end="3778">Spring Security + Nimbus JWT</td></tr><tr data-start="3779" data-end="3820"><td data-start="3779" data-end="3801" data-col-size="sm">Issuer verification</td><td data-col-size="sm" data-start="3801" data-end="3820">Spring Security</td></tr><tr data-start="3821" data-end="3859"><td data-start="3821" data-end="3840" data-col-size="sm">Expiration check</td><td data-col-size="sm" data-start="3840" data-end="3859">Spring Security</td></tr><tr data-start="3860" data-end="3910"><td data-start="3860" data-end="3878" data-col-size="sm">Role extraction</td><td data-col-size="sm" data-start="3878" data-end="3910"><code data-start="3880" data-end="3908">JwtAuthenticationConverter</code></td></tr><tr data-start="3911" data-end="3945"><td data-start="3911" data-end="3930" data-col-size="sm">Role enforcement</td><td data-col-size="sm" data-start="3930" data-end="3945"><code data-start="3932" data-end="3943">hasRole()</code></td></tr><tr data-start="3946" data-end="3989"><td data-start="3946" data-end="3963" data-col-size="sm">Error response</td><td data-col-size="sm" data-start="3963" data-end="3989">Spring Security Filter</td></tr></tbody></table><div class="sticky h-0 select-none end-(--thread-content-margin) self-end"><div class="absolute end-0 flex items-end" style="height: 33px;"><span class="" data-state="closed"><button aria-label="Copy table" class="hover:bg-token-bg-tertiary text-token-text-secondary my-1 rounded-sm p-1 transition-opacity group-[:not(:hover):not(:focus-within)]:pointer-events-none group-[:not(:hover):not(:focus-within)]:opacity-0"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg></button></span></div></div></div></div>
<p data-start="4338" data-end="4362">If you want next, I can:</p>
<ul data-start="4363" data-end="4553">
<li data-start="4363" data-end="4415">
<p data-start="4365" data-end="4415">Show <strong data-start="4370" data-end="4415">JwtAuthenticationConverter implementation</strong></p>
</li>
<li data-start="4416" data-end="4454">
<p data-start="4418" data-end="4454">Explain <strong data-start="4426" data-end="4454">401 vs 403 with diagrams</strong></p>
</li>
<li data-start="4455" data-end="4500">
<p data-start="4457" data-end="4500">Show <strong data-start="4462" data-end="4500">token propagation between services</strong></p>
</li>
<li data-start="4501" data-end="4553">
<p data-start="4503" data-end="4553">Add <strong data-start="4507" data-end="4553">method-level security with <code data-start="4536" data-end="4551">@PreAuthorize</code></strong></p>
</li>
</ul>
<p data-start="4555" data-end="4570" data-is-last-node="" data-is-only-node="">Just tell me üëç</p></div></div>
`,

sync: `
<h1 data-start="342" data-end="382">PART A ‚Äî FEIGN + JWT TOKEN PROPAGATION</h1>
<h2 data-start="384" data-end="403">üéØ Real Scenario</h2>
<ul data-start="404" data-end="536">
    <li data-start="404" data-end="449">
        <p data-start="406" data-end="449">
            <strong data-start="406" data-end="423">Order Service</strong> calls
            <strong data-start="430" data-end="449">Product Service</strong>
        </p>
    </li>
    <li data-start="450" data-end="482">
        <p data-start="452" data-end="482">
            Must forward <strong data-start="465" data-end="482">same user JWT</strong>
        </p>
    </li>
    <li data-start="483" data-end="536">
        <p data-start="485" data-end="536">Product Service must re-validate token (zero trust)</p>
    </li>
</ul>
<hr data-start="538" data-end="541" />
<h2 data-start="543" data-end="563">A1Ô∏è‚É£ Dependencies</h2>
<pre class="overflow-visible! px-0!" data-start="565" data-end="722">
<div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">xml</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-xml"><span><span><span class="hljs-comment">&lt;!-- Feign --&gt;</span></span><span>
</span><span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span></span></span><span>&gt;org.springframework.cloud</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span></span></span><span>&gt;spring-cloud-starter-openfeign</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span></span></span><span>&gt;
</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span></span></span><span>&gt;
</span></span></code></div></div></pre>
<p data-start="724" data-end="737">Enable Feign:</p>
<pre class="overflow-visible! px-0!" data-start="738" data-end="833"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@EnableFeignClients</span></span><span>
</span><span><span class="hljs-meta">@SpringBootApplication</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">OrderServiceApplication</span></span><span> {
}
</span></span></code></div></div></pre>
<hr data-start="835" data-end="838" />
<h2 data-start="840" data-end="886">A2Ô∏è‚É£ JWT Token Propagation (MOST IMPORTANT)</h2>
<h3 data-start="888" data-end="917">Feign Request Interceptor</h3>
<pre class="overflow-visible! px-0!" data-start="919" data-end="1378"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@Component</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">FeignJwtInterceptor</span></span><span> </span><span><span class="hljs-keyword">implements</span></span><span> </span><span><span class="hljs-title class_">RequestInterceptor</span></span><span> {
    </span><span><span class="hljs-meta">@Override</span></span><span>
    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">void</span></span><span> </span><span><span class="hljs-title function_">apply</span></span><span><span class="hljs-params">(RequestTemplate template)</span></span><span> {
        </span><span><span class="hljs-type">Authentication</span></span><span> </span><span><span class="hljs-variable">auth</span></span><span> </span><span><span class="hljs-operator">=</span></span><span>
            SecurityContextHolder.getContext().getAuthentication();

        </span><span><span class="hljs-keyword">if</span></span><span> (auth </span><span><span class="hljs-keyword">instanceof</span></span><span> JwtAuthenticationToken jwtAuth) {
            </span><span><span class="hljs-type">String</span></span><span> </span><span><span class="hljs-variable">token</span></span><span> </span><span><span class="hljs-operator">=</span></span><span> jwtAuth.getToken().getTokenValue();
            template.header(</span><span><span class="hljs-string">"Authorization"</span></span><span>, </span><span><span class="hljs-string">"Bearer "</span></span><span> + token);
        }
    }
}
</span></span></code></div></div></pre>
<p data-start="1380" data-end="1469">
    ‚úî Automatically attaches JWT<br data-start="1408" data-end="1411" />
    ‚úî No manual header passing<br data-start="1437" data-end="1440" />
    ‚úî Works for all Feign calls
</p>
<hr data-start="1471" data-end="1474" />
<h2 data-start="1476" data-end="1512">A3Ô∏è‚É£ Product Service Feign Client</h2>
<div style="
  background: linear-gradient(135deg, #020617, #020617);
  color: #9fe0ff;
  padding: 24px;
  border-radius: 18px;
  font-family: 'JetBrains Mono', Consolas, monospace;
  font-size: 14px;
  line-height: 1.65;
  box-shadow: 0 12px 40px rgba(0,0,0,0.45);
  overflow-x: auto;
  white-space: pre;
">
<span style="color:#38bdf8;">@PreAuthorize</span>(<span style="color:#fbbf24;">"hasRole('USER')"</span>)
<span style="color:#38bdf8;">public</span> <span style="color:#a5b4fc;">Order</span> createOrder(<span style="color:#a5b4fc;">Order</span> order, <span style="color:#a5b4fc;">Authentication</span> auth) {

    <span style="color:#a5b4fc;">StockResponse</span> stock =
        productClient.checkStock(order.getProduct());

    <span style="color:#38bdf8;">if</span> (!stock.available()) {
        <span style="color:#38bdf8;">throw</span> <span style="color:#38bdf8;">new</span> <span style="color:#a5b4fc;">RuntimeException</span>(<span style="color:#fca5a5;">"Out of stock"</span>);
    }

    order.setUserId(auth.getName());
    order.setStatus(<span style="color:#fca5a5;">"CREATED"</span>);

    <span style="color:#a5b4fc;">Order</span> saved = repository.save(order);

    eventPublisher.publishOrderCreated(saved);

    <span style="color:#38bdf8;">return</span> saved;
}
</div>

<h2 data-start="1734" data-end="1766">A4Ô∏è‚É£ Order Service Uses Feign</h2>
<pre class="overflow-visible! px-0!" data-start="1768" data-end="2225"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@PreAuthorize("hasRole('USER')")</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> Order </span><span><span class="hljs-title function_">createOrder</span></span><span><span class="hljs-params">(Order order, Authentication auth)</span></span><span> {
    </span><span><span class="hljs-type">StockResponse</span></span><span> </span><span><span class="hljs-variable">stock</span></span><span> </span><span><span class="hljs-operator">=</span></span><span>
        productClient.checkStock(order.getProduct());

    </span><span><span class="hljs-keyword">if</span></span><span> (!stock.available()) {
        </span><span><span class="hljs-keyword">throw</span></span><span> </span><span><span class="hljs-keyword">new</span></span><span> </span><span><span class="hljs-title class_">RuntimeException</span></span><span>(</span><span><span class="hljs-string">"Out of stock"</span></span><span>);
    }

    order.setUserId(auth.getName());
    order.setStatus(</span><span><span class="hljs-string">"CREATED"</span></span><span>);

    </span><span><span class="hljs-type">Order</span></span><span> </span><span><span class="hljs-variable">saved</span></span><span> </span><span><span class="hljs-operator">=</span></span><span> repository.save(order);

    eventPublisher.publishOrderCreated(saved);

    </span><span><span class="hljs-keyword">return</span></span><span> saved;
}
</span></span></code></div></div></pre>
<hr data-start="2227" data-end="2230" />
<h2 data-start="2232" data-end="2261">üîê What Happens at Runtime</h2>
<div class="runtime-box">
  <strong>Order Service</strong>
  <ul>    
    <li>Feign Interceptor adds JWT</li>
    <li>Product Service validates JWT again</li>
    <li>Role rules applied</li>
  </ul>
</div>
<p data-start="2376" data-end="2416">
    ‚úî Zero trust<br data-start="2388" data-end="2391" />
    ‚úî Secure internal calls
</p>
<hr data-start="2418" data-end="2421" />
`,

security2: `
<div class="markdown prose dark:prose-invert w-full break-words light markdown-new-styling">
<h2 data-start="5255" data-end="5286">üéØ Interview-Perfect Summary</h2>
<blockquote data-start="5288" data-end="5706">
<p data-start="5290" data-end="5706">‚ÄúJWT signature, issuer, and expiration are validated automatically by Spring Security‚Äôs OAuth2 Resource Server. Cognito groups are converted into Spring roles using a JwtAuthenticationConverter. Authentication failures return 401, authorization failures return 403. Tokens are propagated across microservices using Feign interceptors, and fine-grained access control is enforced using @PreAuthorize at method level.‚Äù</p>
</blockquote>
<hr data-start="5708" data-end="5711">
<h1 data-start="230" data-end="302">1Ô∏è‚É£ JwtAuthenticationConverter Implementation (Cognito ‚Üí Spring Roles)</h1>
<p data-start="304" data-end="398">AWS Cognito <strong data-start="316" data-end="328">does NOT</strong> use <code data-start="333" data-end="340">roles</code> by default.<br data-start="352" data-end="355">
It sends roles as <strong data-start="373" data-end="383">groups</strong> in this claim:</p>
<pre class="overflow-visible! px-0!" data-start="400" data-end="447"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">json</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-json"><span><span><span class="hljs-attr">"cognito:groups"</span></span><span><span class="hljs-punctuation">:</span></span><span> </span><span><span class="hljs-punctuation">[</span></span><span><span class="hljs-string">"USER"</span></span><span><span class="hljs-punctuation">,</span></span><span> </span><span><span class="hljs-string">"ADMIN"</span></span><span><span class="hljs-punctuation">]</span></span><span>
</span></span></code></div></div></pre>
<p data-start="449" data-end="473">Spring Security expects:</p>
<pre class="overflow-visible! px-0!" data-start="474" data-end="507"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">text</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-text"><span><span>ROLE_USER, ROLE_ADMIN
</span></span></code></div></div></pre>
<p data-start="509" data-end="557">So we must <strong data-start="520" data-end="556">convert JWT ‚Üí GrantedAuthorities</strong>.</p>
<hr data-start="559" data-end="562">
<h2 data-start="564" data-end="614">‚úÖ JwtAuthenticationConverter (Production-Ready)</h2>
<pre class="overflow-visible! px-0!" data-start="616" data-end="1216"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@Bean</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> JwtAuthenticationConverter </span><span><span class="hljs-title function_">jwtAuthenticationConverter</span></span><span><span class="hljs-params">()</span></span><span> {

    </span><span><span class="hljs-type">JwtGrantedAuthoritiesConverter</span></span><span> </span><span><span class="hljs-variable">authoritiesConverter</span></span><span> </span><span><span class="hljs-operator">=</span></span><span>
            </span><span><span class="hljs-keyword">new</span></span><span> </span><span><span class="hljs-title class_">JwtGrantedAuthoritiesConverter</span></span><span>();

    </span><span><span class="hljs-comment">// Tell Spring where roles exist in JWT</span></span><span>
    authoritiesConverter.setAuthoritiesClaimName(</span><span><span class="hljs-string">"cognito:groups"</span></span><span>);

    </span><span><span class="hljs-comment">// Spring Security requires ROLE_ prefix</span></span><span>
    authoritiesConverter.setAuthorityPrefix(</span><span><span class="hljs-string">"ROLE_"</span></span><span>);

    </span><span><span class="hljs-type">JwtAuthenticationConverter</span></span><span> </span><span><span class="hljs-variable">jwtConverter</span></span><span> </span><span><span class="hljs-operator">=</span></span><span>
            </span><span><span class="hljs-keyword">new</span></span><span> </span><span><span class="hljs-title class_">JwtAuthenticationConverter</span></span><span>();

    jwtConverter.setJwtGrantedAuthoritiesConverter(authoritiesConverter);

    </span><span><span class="hljs-keyword">return</span></span><span> jwtConverter;
}
</span></span></code></div></div></pre>
<h3 data-start="1218" data-end="1248">üîç What happens internally</h3>
<div class="TyagGW_tableContainer"><div tabindex="-1" class="group TyagGW_tableWrapper flex w-fit flex-col-reverse"><table data-start="1249" data-end="1456" class="w-fit min-w-(--thread-content-width)"><thead data-start="1249" data-end="1271"><tr data-start="1249" data-end="1271"><th data-start="1249" data-end="1256" data-col-size="sm">Step</th><th data-start="1256" data-end="1271" data-col-size="sm">Description</th></tr></thead><tbody data-start="1284" data-end="1456"><tr data-start="1284" data-end="1317"><td data-start="1284" data-end="1288" data-col-size="sm">1</td><td data-start="1288" data-end="1317" data-col-size="sm">JWT extracted from header</td></tr><tr data-start="1318" data-end="1360"><td data-start="1318" data-end="1322" data-col-size="sm">2</td><td data-col-size="sm" data-start="1322" data-end="1360">Signature + issuer + exp validated</td></tr><tr data-start="1361" data-end="1390"><td data-start="1361" data-end="1365" data-col-size="sm">3</td><td data-col-size="sm" data-start="1365" data-end="1390"><code data-start="1367" data-end="1383">cognito:groups</code> read</td></tr><tr data-start="1391" data-end="1420"><td data-start="1391" data-end="1395" data-col-size="sm">4</td><td data-col-size="sm" data-start="1395" data-end="1420">Converted to <code data-start="1410" data-end="1418">ROLE_*</code></td></tr><tr data-start="1421" data-end="1456"><td data-start="1421" data-end="1425" data-col-size="sm">5</td><td data-start="1425" data-end="1456" data-col-size="sm">Stored in <code data-start="1437" data-end="1454">SecurityContext</code></td></tr></tbody></table><div class="sticky h-0 select-none end-(--thread-content-margin) self-end"><div class="absolute end-0 flex items-end" style="height: 33px;"><span class="" data-state="closed"><button aria-label="Copy table" class="hover:bg-token-bg-tertiary text-token-text-secondary my-1 rounded-sm p-1 transition-opacity group-[:not(:hover):not(:focus-within)]:pointer-events-none group-[:not(:hover):not(:focus-within)]:opacity-0"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg></button></span></div></div></div></div>
<hr data-start="1458" data-end="1461">
<h1 data-start="1463" data-end="1506">2Ô∏è‚É£ 401 vs 403 ‚Äî With Clear Flow Diagrams</h1>
<p data-start="1508" data-end="1562">This is one of the <strong data-start="1527" data-end="1561">MOST ASKED interview questions</strong>.</p>
<hr data-start="1564" data-end="1567">
<h2 data-start="1569" data-end="1617">üî¥ 401 ‚Äî UNAUTHORIZED (Authentication Failed)</h2>
<h3 data-start="1619" data-end="1630">Meaning</h3>
<blockquote data-start="1631" data-end="1660">
<p data-start="1633" data-end="1660">‚ÄúI don‚Äôt know who you are.‚Äù</p>
</blockquote>
<h3 data-start="1662" data-end="1672">Causes</h3>
<ul data-start="1673" data-end="1756">
<li data-start="1673" data-end="1688">
<p data-start="1675" data-end="1688">Missing token</p>
</li>
<li data-start="1689" data-end="1704">
<p data-start="1691" data-end="1704">Invalid token</p>
</li>
<li data-start="1705" data-end="1720">
<p data-start="1707" data-end="1720">Expired token</p>
</li>
<li data-start="1721" data-end="1735">
<p data-start="1723" data-end="1735">Wrong issuer</p>
</li>
<li data-start="1736" data-end="1756">
<p data-start="1738" data-end="1756">Tampered signature</p>
</li>
</ul>
<div class="no-scrollbar flex min-h-36 flex-nowrap gap-0.5 overflow-auto sm:gap-1 sm:overflow-hidden xl:min-h-44 mt-1 mb-5 [&amp;:not(:first-child)]:mt-4"><div class="border-token-border-default relative w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink max-h-64 sm:w-[calc((100%-0.5rem)/3)] rounded-s-xl" style="aspect-ratio: 5 / 4;"><button class="relative overflow-hidden h-full w-full" style="aspect-ratio: 5 / 4;"><div style="width: 100%; height: 100%; opacity: 1; transform: none;"><img alt="https://www.descope.com/_next/image?q=75&amp;url=https%3A%2F%2Fimages.ctfassets.net%2Fxqb1f63q68s1%2F2FxR8h5ZpzfdE515nTgXTn%2F31f178d73cd582be03bce94920c344b9%2Fmermaid-diagram-2025-04-18-155445.png&amp;w=3840&amp;utm_source=chatgpt.com" referrerpolicy="no-referrer" class="bg-token-main-surface-tertiary absolute inset-0 m-0 h-full w-full object-cover" src="https://www.descope.com/_next/image?q=75&amp;url=https%3A%2F%2Fimages.ctfassets.net%2Fxqb1f63q68s1%2F2FxR8h5ZpzfdE515nTgXTn%2F31f178d73cd582be03bce94920c344b9%2Fmermaid-diagram-2025-04-18-155445.png&amp;w=3840&amp;utm_source=chatgpt.com" style="object-position: 50% 0%; opacity: 1;"></div></button></div><div class="border-token-border-default relative w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink max-h-64 sm:w-[calc((100%-0.5rem)/3)] rounded-e-xl" style="aspect-ratio: 5 / 4;"><button class="relative overflow-hidden h-full w-full" style="aspect-ratio: 5 / 4;"><div style="width: 100%; height: 100%; opacity: 1; transform: none;"><img alt="https://miro.medium.com/1%2AU9L5ao_KQVcxbVeYE4722Q.png?utm_source=chatgpt.com" referrerpolicy="no-referrer" class="bg-token-main-surface-tertiary absolute inset-0 m-0 h-full w-full object-cover" src="https://miro.medium.com/1%2AU9L5ao_KQVcxbVeYE4722Q.png?utm_source=chatgpt.com" style="object-position: 50% 44.9%; opacity: 1;"></div></button></div></div>
<h3 data-start="1800" data-end="1808">Flow</h3>
<pre class="overflow-visible! px-0!" data-start="1809" data-end="1892"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">markdown</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span>Request ‚Üí JWT Validation
<span class="hljs-code">        ‚ùå Token Invalid
        ‚Üí 401 Unauthorized
</span></span></span></code></div></div></pre>
<h3 data-start="1894" data-end="1905">Example</h3>
<pre class="overflow-visible! px-0!" data-start="1906" data-end="1953"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">http</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-http"><span>Authorization: Bearer EXPIRED_TOKEN
</span></code></div></div></pre>
<pre class="overflow-visible! px-0!" data-start="1955" data-end="2017"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">json</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-json"><span><span>HTTP </span><span><span class="hljs-number">401</span></span><span>
</span><span><span class="hljs-punctuation">{</span></span><span>
  </span><span><span class="hljs-attr">"error"</span></span><span><span class="hljs-punctuation">:</span></span><span> </span><span><span class="hljs-string">"Invalid or expired token"</span></span><span>
</span><span><span class="hljs-punctuation">}</span></span><span>
</span></span></code></div></div></pre>
<hr data-start="2019" data-end="2022">
<h2 data-start="2024" data-end="2068">üü° 403 ‚Äî FORBIDDEN (Authorization Failed)</h2>
<h3 data-start="2070" data-end="2081">Meaning</h3>
<blockquote data-start="2082" data-end="2130">
<p data-start="2084" data-end="2130">‚ÄúI know who you are, but you are NOT allowed.‚Äù</p>
</blockquote>
<h3 data-start="2132" data-end="2142">Causes</h3>
<ul data-start="2143" data-end="2183">
<li data-start="2143" data-end="2157">
<p data-start="2145" data-end="2157">Missing role</p>
</li>
<li data-start="2158" data-end="2183">
<p data-start="2160" data-end="2183">Insufficient permission</p>
</li>
</ul>
<div class="no-scrollbar flex min-h-36 flex-nowrap gap-0.5 overflow-auto sm:gap-1 sm:overflow-hidden xl:min-h-44 mt-1 mb-5 [&amp;:not(:first-child)]:mt-4"><div class="border-token-border-default relative w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink max-h-64 sm:w-[calc((100%-0.5rem)/3)] rounded-s-xl" style="aspect-ratio: 5 / 4;"><button class="relative overflow-hidden h-full w-full" style="aspect-ratio: 5 / 4;"><div style="width: 100%; height: 100%; opacity: 1; transform: none;"><img alt="https://community.sap.com/legacyfs/online/storage/blog_attachments/2022/03/diagram2-1.png?utm_source=chatgpt.com" referrerpolicy="no-referrer" class="bg-token-main-surface-tertiary absolute inset-0 m-0 h-full w-full object-cover" src="https://community.sap.com/legacyfs/online/storage/blog_attachments/2022/03/diagram2-1.png?utm_source=chatgpt.com" style="object-position: 100% 50%; opacity: 1;"></div></button></div><div class="border-token-border-default relative w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink max-h-64 sm:w-[calc((100%-0.5rem)/3)] rounded-e-xl" style="aspect-ratio: 5 / 4;"><button class="relative overflow-hidden h-full w-full" style="aspect-ratio: 5 / 4;"><div style="width: 100%; height: 100%; opacity: 1; transform: none;"><img alt="https://docs.spring.io/spring-security/reference/_images/servlet/authorization/access-decision-voting.png?utm_source=chatgpt.com" referrerpolicy="no-referrer" class="bg-token-main-surface-tertiary absolute inset-0 m-0 h-full w-full object-cover" src="https://docs.spring.io/spring-security/reference/_images/servlet/authorization/access-decision-voting.png?utm_source=chatgpt.com" style="object-position: 24% 50%; opacity: 1;"></div></button></div></div>
<h3 data-start="2227" data-end="2235">Flow</h3>
<pre class="overflow-visible! px-0!" data-start="2236" data-end="2331"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">pgsql</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span>Request ‚Üí JWT </span><span><span class="hljs-keyword">Valid</span></span><span>
        ‚Üí </span><span><span class="hljs-keyword">Role</span></span><span> </span><span><span class="hljs-keyword">Check</span></span><span>
        ‚ùå </span><span><span class="hljs-keyword">Role</span></span><span> Missing
        ‚Üí </span><span><span class="hljs-number">403</span></span><span> Forbidden
</span></span></code></div></div></pre>
<h3 data-start="2333" data-end="2344">Example</h3>
<pre class="overflow-visible! px-0!" data-start="2345" data-end="2373"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span>hasRole(</span><span><span class="hljs-string">"ADMIN"</span></span><span>)
</span></span></code></div></div></pre>
<p data-start="2375" data-end="2388">JWT contains:</p>
<pre class="overflow-visible! px-0!" data-start="2389" data-end="2427"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">json</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-json"><span><span><span class="hljs-attr">"cognito:groups"</span></span><span><span class="hljs-punctuation">:</span></span><span> </span><span><span class="hljs-punctuation">[</span></span><span><span class="hljs-string">"USER"</span></span><span><span class="hljs-punctuation">]</span></span><span>
</span></span></code></div></div></pre>
<pre class="overflow-visible! px-0!" data-start="2429" data-end="2480"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">json</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-json"><span><span>HTTP </span><span><span class="hljs-number">403</span></span><span>
</span><span><span class="hljs-punctuation">{</span></span><span>
  </span><span><span class="hljs-attr">"error"</span></span><span><span class="hljs-punctuation">:</span></span><span> </span><span><span class="hljs-string">"Access Denied"</span></span><span>
</span><span><span class="hljs-punctuation">}</span></span><span>
</span></span></code></div></div></pre>
<hr data-start="2482" data-end="2485">
<h2 data-start="2487" data-end="2513">üß† Interview Gold Table</h2>
<div class="TyagGW_tableContainer"><div tabindex="-1" class="group TyagGW_tableWrapper flex w-fit flex-col-reverse"><table data-start="2515" data-end="2658" class="w-fit min-w-(--thread-content-width)"><thead data-start="2515" data-end="2546"><tr data-start="2515" data-end="2546"><th data-start="2515" data-end="2522" data-col-size="sm">Code</th><th data-start="2522" data-end="2532" data-col-size="sm">Meaning</th><th data-start="2532" data-end="2546" data-col-size="sm">Checked By</th></tr></thead><tbody data-start="2561" data-end="2658"><tr data-start="2561" data-end="2609"><td data-start="2561" data-end="2567" data-col-size="sm">401</td><td data-start="2567" data-end="2591" data-col-size="sm">Authentication failed</td><td data-col-size="sm" data-start="2591" data-end="2609">JWT validation</td></tr><tr data-start="2610" data-end="2658"><td data-start="2610" data-end="2616" data-col-size="sm">403</td><td data-start="2616" data-end="2639" data-col-size="sm">Authorization failed</td><td data-col-size="sm" data-start="2639" data-end="2658">Role/permission</td></tr></tbody></table><div class="sticky h-0 select-none end-(--thread-content-margin) self-end"><div class="absolute end-0 flex items-end" style="height: 33px;"><span class="" data-state="closed"><button aria-label="Copy table" class="hover:bg-token-bg-tertiary text-token-text-secondary my-1 rounded-sm p-1 transition-opacity group-[:not(:hover):not(:focus-within)]:pointer-events-none group-[:not(:hover):not(:focus-within)]:opacity-0"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg></button></span></div></div></div></div>
<hr data-start="2660" data-end="2663">
<h1 data-start="2665" data-end="2710">3Ô∏è‚É£ Token Propagation Between Microservices</h1>
<p data-start="2712" data-end="2777">Once authenticated, <strong data-start="2732" data-end="2776">the SAME JWT must travel across services</strong>.</p>
<hr data-start="2779" data-end="2782">
<h2 data-start="2784" data-end="2798">üîÅ Scenario</h2>
<p data-start="2799" data-end="2830">Order Service ‚Üí Product Service</p>
<hr data-start="2832" data-end="2835">
<h2 data-start="2837" data-end="2855">üß© Architecture</h2>
<div class="no-scrollbar flex min-h-36 flex-nowrap gap-0.5 overflow-auto sm:gap-1 sm:overflow-hidden xl:min-h-44 mt-1 mb-5 [&amp;:not(:first-child)]:mt-4"><div class="border-token-border-default relative w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink max-h-64 sm:w-[calc((100%-0.5rem)/3)] rounded-s-xl" style="aspect-ratio: 5 / 4;"><button class="relative overflow-hidden h-full w-full" style="aspect-ratio: 5 / 4;"><div style="width: 100%; height: 100%; opacity: 1; transform: none;"><img alt="https://cheatsheetseries.owasp.org/assets/Signed_ID_propogation.png?utm_source=chatgpt.com" referrerpolicy="no-referrer" class="bg-token-main-surface-tertiary absolute inset-0 m-0 h-full w-full object-cover" src="https://cheatsheetseries.owasp.org/assets/Signed_ID_propogation.png?utm_source=chatgpt.com" style="object-position: 0% 50%; opacity: 1;"></div></button></div><div class="border-token-border-default relative w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink max-h-64 sm:w-[calc((100%-0.5rem)/3)] rounded-e-xl" style="aspect-ratio: 5 / 4;"><button class="relative overflow-hidden h-full w-full" style="aspect-ratio: 5 / 4;"><div style="width: 100%; height: 100%; opacity: 1; transform: none;"><img alt="https://miro.medium.com/v2/resize%3Afit%3A1358/format%3Awebp/0%2Ac6oEtLizkWAvrH1m?utm_source=chatgpt.com" referrerpolicy="no-referrer" class="bg-token-main-surface-tertiary absolute inset-0 m-0 h-full w-full object-cover" src="https://miro.medium.com/v2/resize%3Afit%3A1358/format%3Awebp/0%2Ac6oEtLizkWAvrH1m?utm_source=chatgpt.com" style="object-position: 100% 50%; opacity: 1;"></div></button></div></div>
<hr data-start="2899" data-end="2902">
<h2 data-start="2904" data-end="2943">‚úÖ Feign Client with Token Forwarding</h2>
<h3 data-start="2945" data-end="2974">Step 1: Feign Interceptor</h3>
<pre class="overflow-visible! px-0!" data-start="2976" data-end="3436"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@Component</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">FeignAuthInterceptor</span></span><span> </span><span><span class="hljs-keyword">implements</span></span><span> </span><span><span class="hljs-title class_">RequestInterceptor</span></span><span> {

    </span><span><span class="hljs-meta">@Override</span></span><span>
    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">void</span></span><span> </span><span><span class="hljs-title function_">apply</span></span><span><span class="hljs-params">(RequestTemplate template)</span></span><span> {
        </span><span><span class="hljs-type">Authentication</span></span><span> </span><span><span class="hljs-variable">auth</span></span><span> </span><span><span class="hljs-operator">=</span></span><span>
            SecurityContextHolder.getContext().getAuthentication();

        </span><span><span class="hljs-keyword">if</span></span><span> (auth </span><span><span class="hljs-keyword">instanceof</span></span><span> JwtAuthenticationToken jwtAuth) {
            </span><span><span class="hljs-type">String</span></span><span> </span><span><span class="hljs-variable">token</span></span><span> </span><span><span class="hljs-operator">=</span></span><span> jwtAuth.getToken().getTokenValue();
            template.header(</span><span><span class="hljs-string">"Authorization"</span></span><span>, </span><span><span class="hljs-string">"Bearer "</span></span><span> + token);
        }
    }
}
</span></span></code></div></div></pre>
<hr data-start="3438" data-end="3441">
<h3 data-start="3443" data-end="3467">Step 2: Feign Client</h3>
<pre class="overflow-visible! px-0!" data-start="3469" data-end="3644"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@FeignClient(name = "product-service")</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">interface</span></span><span> </span><span><span class="hljs-title class_">ProductClient</span></span><span> {

    </span><span><span class="hljs-meta">@GetMapping("/products/{id}")</span></span><span>
    ProductResponse </span><span><span class="hljs-title function_">getProduct</span></span><span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span></span></span><span> Long id);
}
</span></span></code></div></div></pre>
<hr data-start="3646" data-end="3649">
<h2 data-start="3651" data-end="3682">üîê What Product Service Does</h2>
<ul data-start="3683" data-end="3751">
<li data-start="3683" data-end="3704">
<p data-start="3685" data-end="3704">Validates JWT again</p>
</li>
<li data-start="3705" data-end="3725">
<p data-start="3707" data-end="3725">Applies role rules</p>
</li>
<li data-start="3726" data-end="3751">
<p data-start="3728" data-end="3751">Executes business logic</p>
</li>
</ul>
<p data-start="3753" data-end="3811">‚úî Zero trust<br data-start="3765" data-end="3768">
‚úî No shared secrets<br data-start="3787" data-end="3790">
‚úî Same security chain</p>
<hr data-start="3813" data-end="3816">
<h2 data-start="3818" data-end="3838">üî• Interview Line</h2>
<blockquote data-start="3839" data-end="3981">
<p data-start="3841" data-end="3981">‚ÄúJWT is propagated downstream via Feign interceptors, ensuring every microservice independently validates authentication and authorization.‚Äù</p>
</blockquote>
<hr data-start="3983" data-end="3986">
<h1 data-start="3988" data-end="4034">4Ô∏è‚É£ Method-Level Security with @PreAuthorize</h1>
<p data-start="4036" data-end="4089">This allows <strong data-start="4048" data-end="4072">fine-grained control</strong> at method level.</p>
<hr data-start="4091" data-end="4094">
<h2 data-start="4096" data-end="4123">‚úÖ Enable Method Security</h2>
<pre class="overflow-visible! px-0!" data-start="4125" data-end="4211"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@EnableMethodSecurity</span></span><span>
</span><span><span class="hljs-meta">@Configuration</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">MethodSecurityConfig</span></span><span> {
}
</span></span></code></div></div></pre>
<hr data-start="4213" data-end="4216">
<h2 data-start="4218" data-end="4238">üîê Usage Examples</h2>
<h3 data-start="4240" data-end="4254">Role-based</h3>
<pre class="overflow-visible! px-0!" data-start="4255" data-end="4329"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@PreAuthorize("hasRole('USER')")</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> Order </span><span><span class="hljs-title function_">placeOrder</span></span><span><span class="hljs-params">()</span></span><span> {
}
</span></span></code></div></div></pre>
<hr data-start="4331" data-end="4334">
<h3 data-start="4336" data-end="4354">Multiple roles</h3>
<pre class="overflow-visible! px-0!" data-start="4355" data-end="4413"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@PreAuthorize("hasAnyRole('ADMIN','MANAGER')")</span></span><span>
</span></span></code></div></div></pre>
<hr data-start="4415" data-end="4418">
<h3 data-start="4420" data-end="4440">Using JWT Claims</h3>
<pre class="overflow-visible! px-0!" data-start="4441" data-end="4564"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@PreAuthorize("#userId == authentication.token.claims['sub']")</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> UserProfile </span><span><span class="hljs-title function_">getProfile</span></span><span><span class="hljs-params">(String userId)</span></span><span> {
}
</span></span></code></div></div></pre>
<hr data-start="4566" data-end="4569">
<h3 data-start="4571" data-end="4592">Custom Permission</h3>
<pre class="overflow-visible! px-0!" data-start="4593" data-end="4659"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@PreAuthorize("@orderSecurity.canViewOrder(#orderId)")</span></span><span>
</span></span></code></div></div></pre>
<pre class="overflow-visible! px-0!" data-start="4661" data-end="4819"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@Component</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">OrderSecurity</span></span><span> {

    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-type">boolean</span></span><span> </span><span><span class="hljs-title function_">canViewOrder</span></span><span><span class="hljs-params">(String orderId)</span></span><span> {
        </span><span><span class="hljs-comment">// custom DB check</span></span><span>
        </span><span><span class="hljs-keyword">return</span></span><span> </span><span><span class="hljs-literal">true</span></span><span>;
    }
}
</span></span></code></div></div></pre>
<hr data-start="4821" data-end="4824">
<h2 data-start="4826" data-end="4859">üß† Execution Order (IMPORTANT)</h2>
<div class="no-scrollbar flex min-h-36 flex-nowrap gap-0.5 overflow-auto sm:gap-1 sm:overflow-hidden xl:min-h-44 mt-1 mb-5 [&amp;:not(:first-child)]:mt-4"><div class="border-token-border-default relative w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink max-h-64 sm:w-[calc((100%-0.5rem)/3)] rounded-s-xl" style="aspect-ratio: 5 / 4;"><button class="relative overflow-hidden h-full w-full" style="aspect-ratio: 5 / 4;"><div style="width: 100%; height: 100%; opacity: 1; transform: none;"><img alt="https://miro.medium.com/v2/resize%3Afit%3A1400/0%2AhWHCyDOkrcPVvIxG.png?utm_source=chatgpt.com" referrerpolicy="no-referrer" class="bg-token-main-surface-tertiary absolute inset-0 m-0 h-full w-full object-cover" src="https://miro.medium.com/v2/resize%3Afit%3A1400/0%2AhWHCyDOkrcPVvIxG.png?utm_source=chatgpt.com" style="object-position: 0% 50%; opacity: 1;"></div></button></div><div class="border-token-border-default relative w-32 shrink-0 overflow-hidden rounded-xl border-[0.5px] md:shrink max-h-64 sm:w-[calc((100%-0.5rem)/3)] rounded-e-xl" style="aspect-ratio: 5 / 4;"><button class="relative overflow-hidden h-full w-full" style="aspect-ratio: 5 / 4;"><div style="width: 100%; height: 100%; opacity: 1; transform: none;"><img alt="https://docs.enterprise.spring.io/spring-security/reference/_images/servlet/authorization/methodsecurity.png?utm_source=chatgpt.com" referrerpolicy="no-referrer" class="bg-token-main-surface-tertiary absolute inset-0 m-0 h-full w-full object-cover" src="https://docs.enterprise.spring.io/spring-security/reference/_images/servlet/authorization/methodsecurity.png?utm_source=chatgpt.com" style="object-position: 100% 50%; opacity: 1;"></div></button></div></div>
<pre class="overflow-visible! px-0!" data-start="4903" data-end="5010"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">less</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span><span class="hljs-selector-tag">JWT</span></span><span> </span><span><span class="hljs-selector-tag">Validation</span></span><span>
 ‚Üí </span><span><span class="hljs-selector-tag">Role</span></span><span> </span><span><span class="hljs-selector-tag">Mapping</span></span><span>
 ‚Üí </span><span><span class="hljs-selector-tag">URL</span></span><span> </span><span><span class="hljs-selector-tag">Security</span></span><span>
 ‚Üí </span><span><span class="hljs-selector-tag">Method</span></span><span> </span><span><span class="hljs-selector-tag">Security</span></span><span> (</span><span><span class="hljs-variable">@PreAuthorize</span></span><span>)
 ‚Üí </span><span><span class="hljs-selector-tag">Business</span></span><span> </span><span><span class="hljs-selector-tag">Logic</span></span><span>
</span></span></code></div></div></pre>
<hr data-start="5012" data-end="5015">
<h2 data-start="5017" data-end="5053">üèÅ COMPLETE SECURITY FLOW SUMMARY</h2>
<pre class="overflow-visible! px-0!" data-start="5055" data-end="5248"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">mathematica</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span><span class="hljs-variable">Client</span></span><span> ‚Üí </span><span><span class="hljs-variable">API</span></span><span> </span><span><span class="hljs-variable">Gateway</span></span><span> ‚Üí </span><span><span class="hljs-variable">ALB</span></span><span> ‚Üí </span><span><span class="hljs-variable">Microservice</span></span><span>
       </span><span><span class="hljs-variable">JWT</span></span><span> </span><span><span class="hljs-variable">Validated</span></span><span> </span><span><span class="hljs-punctuation">(</span></span><span><span class="hljs-built_in">Signature</span></span><span><span class="hljs-operator">,</span></span><span> </span><span><span class="hljs-variable">Issuer</span></span><span><span class="hljs-operator">,</span></span><span> </span><span><span class="hljs-built_in">Exp</span></span><span><span class="hljs-punctuation">)</span></span><span>
       </span><span><span class="hljs-variable">Roles</span></span><span> </span><span><span class="hljs-variable">Extracted</span></span><span>
       </span><span><span class="hljs-built_in">URL</span></span><span> </span><span><span class="hljs-variable">Rules</span></span><span> </span><span><span class="hljs-variable">Checked</span></span><span>
       </span><span><span class="hljs-built_in">Method</span></span><span> </span><span><span class="hljs-variable">Rules</span></span><span> </span><span><span class="hljs-variable">Checked</span></span><span>
       </span><span><span class="hljs-variable">Business</span></span><span> </span><span><span class="hljs-variable">Logic</span></span><span>
</span></span></code></div></div></pre>
<hr data-start="5250" data-end="5253">
</div>
`,

security3: `
<div class="markdown prose dark:prose-invert w-full break-words light markdown-new-styling">
<p data-start="149" data-end="228">This covers <strong data-start="161" data-end="193">CREATE, VIEW, UPDATE, DELETE</strong> with <strong data-start="199" data-end="227">real authorization rules</strong>.</p>
<blockquote data-start="230" data-end="293">
<p data-start="232" data-end="293">This is exactly how an <strong data-start="255" data-end="283">enterprise Order Service</strong> is built.</p>
</blockquote>
<hr data-start="295" data-end="298">
<h1 data-start="300" data-end="350">üõí ORDER SERVICE ‚Äî FULL IMPLEMENTATION (SECURED)</h1>
<h2 data-start="352" data-end="383">üîê Security Rules (Business)</h2>
<div class="TyagGW_tableContainer"><div tabindex="-1" class="group TyagGW_tableWrapper flex w-fit flex-col-reverse"><table data-start="385" data-end="578" class="w-fit min-w-(--thread-content-width)"><thead data-start="385" data-end="411"><tr data-start="385" data-end="411"><th data-start="385" data-end="397" data-col-size="sm">Operation</th><th data-start="397" data-end="411" data-col-size="sm">Who can do</th></tr></thead><tbody data-start="422" data-end="578"><tr data-start="422" data-end="445"><td data-start="422" data-end="437" data-col-size="sm">Create order</td><td data-col-size="sm" data-start="437" data-end="445">USER</td></tr><tr data-start="446" data-end="479"><td data-start="446" data-end="463" data-col-size="sm">View own order</td><td data-col-size="sm" data-start="463" data-end="479">USER (owner)</td></tr><tr data-start="480" data-end="507"><td data-start="480" data-end="498" data-col-size="sm">View all orders</td><td data-col-size="sm" data-start="498" data-end="507">ADMIN</td></tr><tr data-start="508" data-end="548"><td data-start="508" data-end="523" data-col-size="sm">Update order</td><td data-start="523" data-end="548" data-col-size="sm">USER (owner) or ADMIN</td></tr><tr data-start="549" data-end="578"><td data-start="549" data-end="564" data-col-size="sm">Delete order</td><td data-start="564" data-end="578" data-col-size="sm">ADMIN only</td></tr></tbody></table><div class="sticky h-0 select-none end-(--thread-content-margin) self-end"><div class="absolute end-0 flex items-end" style="height: 33px;"><span class="" data-state="closed"><button aria-label="Copy table" class="hover:bg-token-bg-tertiary text-token-text-secondary my-1 rounded-sm p-1 transition-opacity group-[:not(:hover):not(:focus-within)]:pointer-events-none group-[:not(:hover):not(:focus-within)]:opacity-0"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg></button></span></div></div></div></div>
<hr data-start="580" data-end="583">
<h2 data-start="585" data-end="622">1Ô∏è‚É£ Project Dependencies (pom.xml)</h2>
<pre class="overflow-visible! px-0!" data-start="624" data-end="1335"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">xml</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-xml"><span><span><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span></span></span><span>&gt;
    </span><span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span></span></span><span>&gt;org.springframework.boot</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span></span></span><span>&gt;
    </span><span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span></span></span><span>&gt;spring-boot-starter-web</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span></span></span><span>&gt;

  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span></span></span><span>&gt;
    </span><span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span></span></span><span>&gt;org.springframework.boot</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span></span></span><span>&gt;
    </span><span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span></span></span><span>&gt;spring-boot-starter-security</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span></span></span><span>&gt;

  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span></span></span><span>&gt;
    </span><span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span></span></span><span>&gt;org.springframework.boot</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span></span></span><span>&gt;
    </span><span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span></span></span><span>&gt;spring-boot-starter-oauth2-resource-server</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span></span></span><span>&gt;

  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span></span></span><span>&gt;
    </span><span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span></span></span><span>&gt;org.springframework.boot</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span></span></span><span>&gt;
    </span><span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span></span></span><span>&gt;spring-boot-starter-data-jpa</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span></span></span><span>&gt;

  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span></span></span><span>&gt;
    </span><span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span></span></span><span>&gt;org.postgresql</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span></span></span><span>&gt;
    </span><span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span></span></span><span>&gt;postgresql</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span></span></span><span>&gt;
</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span></span></span><span>&gt;
</span></span></code></div></div></pre>
<hr data-start="1337" data-end="1340">
<h2 data-start="1342" data-end="1363">2Ô∏è‚É£ Entity (Order)</h2>
<pre class="overflow-visible! px-0!" data-start="1365" data-end="1648"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@Entity</span></span><span>
</span><span><span class="hljs-meta">@Table(name = "orders")</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">Order</span></span><span> {

    </span><span><span class="hljs-meta">@Id</span></span><span>
    </span><span><span class="hljs-meta">@GeneratedValue(strategy = GenerationType.UUID)</span></span><span>
    </span><span><span class="hljs-keyword">private</span></span><span> String id;

    </span><span><span class="hljs-keyword">private</span></span><span> String userId;
    </span><span><span class="hljs-keyword">private</span></span><span> String product;
    </span><span><span class="hljs-keyword">private</span></span><span> </span><span><span class="hljs-type">int</span></span><span> quantity;
    </span><span><span class="hljs-keyword">private</span></span><span> String status;

    </span><span><span class="hljs-comment">// getters/setters</span></span><span>
}
</span></span></code></div></div></pre>
<hr data-start="1650" data-end="1653">
<h2 data-start="1655" data-end="1672">3Ô∏è‚É£ Repository</h2>
<pre class="overflow-visible! px-0!" data-start="1674" data-end="1865"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">interface</span></span><span> </span><span><span class="hljs-title class_">OrderRepository</span></span><span> </span><span><span class="hljs-keyword">extends</span></span><span> </span><span><span class="hljs-title class_">JpaRepository</span></span><span>&lt;Order, String&gt; {

    </span><span><span class="hljs-type">boolean</span></span><span> </span><span><span class="hljs-title function_">existsByIdAndUserId</span></span><span><span class="hljs-params">(String id, String userId)</span></span><span>;

    List&lt;Order&gt; </span><span><span class="hljs-title function_">findByUserId</span></span><span><span class="hljs-params">(String userId)</span></span><span>;
}
</span></span></code></div></div></pre>
<hr data-start="1867" data-end="1870">
<h2 data-start="1872" data-end="1925">4Ô∏è‚É£ Security Configuration (JWT + Method Security)</h2>
<pre class="overflow-visible! px-0!" data-start="1927" data-end="3046"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@Configuration</span></span><span>
</span><span><span class="hljs-meta">@EnableWebSecurity</span></span><span>
</span><span><span class="hljs-meta">@EnableMethodSecurity</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">SecurityConfig</span></span><span> {

    </span><span><span class="hljs-meta">@Bean</span></span><span>
    SecurityFilterChain </span><span><span class="hljs-title function_">filterChain</span></span><span><span class="hljs-params">(HttpSecurity http)</span></span><span> </span><span><span class="hljs-keyword">throws</span></span><span> Exception {
        http
            .csrf(csrf -&gt; csrf.disable())
            .authorizeHttpRequests(auth -&gt; auth
                .requestMatchers(</span><span><span class="hljs-string">"/orders/**"</span></span><span>).authenticated()
            )
            .oauth2ResourceServer(oauth -&gt; oauth
                .jwt(jwt -&gt; jwt
                    .jwtAuthenticationConverter(jwtAuthenticationConverter())
                )
            );

        </span><span><span class="hljs-keyword">return</span></span><span> http.build();
    }

    </span><span><span class="hljs-meta">@Bean</span></span><span>
    JwtAuthenticationConverter </span><span><span class="hljs-title function_">jwtAuthenticationConverter</span></span><span><span class="hljs-params">()</span></span><span> {

        </span><span><span class="hljs-type">JwtGrantedAuthoritiesConverter</span></span><span> </span><span><span class="hljs-variable">authoritiesConverter</span></span><span> </span><span><span class="hljs-operator">=</span></span><span>
                </span><span><span class="hljs-keyword">new</span></span><span> </span><span><span class="hljs-title class_">JwtGrantedAuthoritiesConverter</span></span><span>();

        authoritiesConverter.setAuthoritiesClaimName(</span><span><span class="hljs-string">"cognito:groups"</span></span><span>);
        authoritiesConverter.setAuthorityPrefix(</span><span><span class="hljs-string">"ROLE_"</span></span><span>);

        </span><span><span class="hljs-type">JwtAuthenticationConverter</span></span><span> </span><span><span class="hljs-variable">converter</span></span><span> </span><span><span class="hljs-operator">=</span></span><span>
                </span><span><span class="hljs-keyword">new</span></span><span> </span><span><span class="hljs-title class_">JwtAuthenticationConverter</span></span><span>();

        converter.setJwtGrantedAuthoritiesConverter(authoritiesConverter);
        </span><span><span class="hljs-keyword">return</span></span><span> converter;
    }
}
</span></span></code></div></div></pre>
<hr data-start="3048" data-end="3051">
<h2 data-start="3053" data-end="3088">5Ô∏è‚É£ application.yml (JWT Issuer)</h2>
<pre class="overflow-visible! px-0!" data-start="3090" data-end="3251"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">yaml</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-yaml"><span><span><span class="hljs-attr">spring:</span></span><span>
  </span><span><span class="hljs-attr">security:</span></span><span>
    </span><span><span class="hljs-attr">oauth2:</span></span><span>
      </span><span><span class="hljs-attr">resourceserver:</span></span><span>
        </span><span><span class="hljs-attr">jwt:</span></span><span>
          </span><span><span class="hljs-attr">issuer-uri:</span></span><span> </span><span><span class="hljs-string">https://cognito-idp.ap-south-1.amazonaws.com/ap-south-1_xxxx</span></span><span>
</span></span></code></div></div></pre>
<hr data-start="3253" data-end="3256">
<h2 data-start="3258" data-end="3298">6Ô∏è‚É£ Security Helper (Ownership Check)</h2>
<pre class="overflow-visible! px-0!" data-start="3300" data-end="3713"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@Component</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">OrderSecurity</span></span><span> {

    </span><span><span class="hljs-keyword">private</span></span><span> </span><span><span class="hljs-keyword">final</span></span><span> OrderRepository orderRepository;

    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-title function_">OrderSecurity</span></span><span><span class="hljs-params">(OrderRepository orderRepository)</span></span><span> {
        </span><span><span class="hljs-built_in">this</span></span><span>.orderRepository = orderRepository;
    }

    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-type">boolean</span></span><span> </span><span><span class="hljs-title function_">isOwner</span></span><span><span class="hljs-params">(String orderId, Authentication auth)</span></span><span> {
        </span><span><span class="hljs-type">String</span></span><span> </span><span><span class="hljs-variable">userId</span></span><span> </span><span><span class="hljs-operator">=</span></span><span> auth.getName(); </span><span><span class="hljs-comment">// JWT sub</span></span><span>
        </span><span><span class="hljs-keyword">return</span></span><span> orderRepository.existsByIdAndUserId(orderId, userId);
    }
}
</span></span></code></div></div></pre>
<hr data-start="3715" data-end="3718">
<h2 data-start="3720" data-end="3768">7Ô∏è‚É£ Service Layer (BUSINESS LOGIC + SECURITY)</h2>
<pre class="overflow-visible! px-0!" data-start="3770" data-end="5151"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@Service</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">OrderService</span></span><span> {

    </span><span><span class="hljs-keyword">private</span></span><span> </span><span><span class="hljs-keyword">final</span></span><span> OrderRepository repository;

    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-title function_">OrderService</span></span><span><span class="hljs-params">(OrderRepository repository)</span></span><span> {
        </span><span><span class="hljs-built_in">this</span></span><span>.repository = repository;
    }

    </span><span><span class="hljs-comment">// CREATE</span></span><span>
    </span><span><span class="hljs-meta">@PreAuthorize("hasRole('USER')")</span></span><span>
    </span><span><span class="hljs-keyword">public</span></span><span> Order </span><span><span class="hljs-title function_">createOrder</span></span><span><span class="hljs-params">(Order order, Authentication auth)</span></span><span> {
        order.setUserId(auth.getName());
        order.setStatus(</span><span><span class="hljs-string">"CREATED"</span></span><span>);
        </span><span><span class="hljs-keyword">return</span></span><span> repository.save(order);
    }

    </span><span><span class="hljs-comment">// VIEW OWN ORDER</span></span><span>
    </span><span><span class="hljs-meta">@PreAuthorize("@orderSecurity.isOwner(#orderId, authentication)")</span></span><span>
    </span><span><span class="hljs-keyword">public</span></span><span> Order </span><span><span class="hljs-title function_">getOrder</span></span><span><span class="hljs-params">(String orderId)</span></span><span> {
        </span><span><span class="hljs-keyword">return</span></span><span> repository.findById(orderId).orElseThrow();
    }

    </span><span><span class="hljs-comment">// VIEW ALL (ADMIN)</span></span><span>
    </span><span><span class="hljs-meta">@PreAuthorize("hasRole('ADMIN')")</span></span><span>
    </span><span><span class="hljs-keyword">public</span></span><span> List&lt;Order&gt; </span><span><span class="hljs-title function_">getAllOrders</span></span><span><span class="hljs-params">()</span></span><span> {
        </span><span><span class="hljs-keyword">return</span></span><span> repository.findAll();
    }

    </span><span><span class="hljs-comment">// UPDATE (OWNER OR ADMIN)</span></span><span>
    <span class="hljs-meta">@PreAuthorize("""
        hasRole('ADMIN') ||
        (hasRole('USER') &amp;&amp; @orderSecurity.isOwner(#orderId, authentication))
    """)</span>
    </span><span><span class="hljs-keyword">public</span></span><span> Order </span><span><span class="hljs-title function_">updateOrder</span></span><span><span class="hljs-params">(String orderId, Order updated)</span></span><span> {
        </span><span><span class="hljs-type">Order</span></span><span> </span><span><span class="hljs-variable">order</span></span><span> </span><span><span class="hljs-operator">=</span></span><span> repository.findById(orderId).orElseThrow();
        order.setProduct(updated.getProduct());
        order.setQuantity(updated.getQuantity());
        </span><span><span class="hljs-keyword">return</span></span><span> repository.save(order);
    }

    </span><span><span class="hljs-comment">// DELETE (ADMIN ONLY)</span></span><span>
    </span><span><span class="hljs-meta">@PreAuthorize("hasRole('ADMIN')")</span></span><span>
    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">void</span></span><span> </span><span><span class="hljs-title function_">deleteOrder</span></span><span><span class="hljs-params">(String orderId)</span></span><span> {
        repository.deleteById(orderId);
    }
}
</span></span></code></div></div></pre>
<hr data-start="5153" data-end="5156">
<h2 data-start="5158" data-end="5181">8Ô∏è‚É£ Controller Layer</h2>
<pre class="overflow-visible! px-0!" data-start="5183" data-end="6034"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@RestController</span></span><span>
</span><span><span class="hljs-meta">@RequestMapping("/orders")</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">OrderController</span></span><span> {

    </span><span><span class="hljs-keyword">private</span></span><span> </span><span><span class="hljs-keyword">final</span></span><span> OrderService service;

    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-title function_">OrderController</span></span><span><span class="hljs-params">(OrderService service)</span></span><span> {
        </span><span><span class="hljs-built_in">this</span></span><span>.service = service;
    }

    </span><span><span class="hljs-meta">@PostMapping</span></span><span>
    </span><span><span class="hljs-keyword">public</span></span><span> Order </span><span><span class="hljs-title function_">create</span></span><span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span></span></span><span> Order order, Authentication auth) {
        </span><span><span class="hljs-keyword">return</span></span><span> service.createOrder(order, auth);
    }

    </span><span><span class="hljs-meta">@GetMapping("/{id}")</span></span><span>
    </span><span><span class="hljs-keyword">public</span></span><span> Order </span><span><span class="hljs-title function_">get</span></span><span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span></span></span><span> String id) {
        </span><span><span class="hljs-keyword">return</span></span><span> service.getOrder(id);
    }

    </span><span><span class="hljs-meta">@GetMapping</span></span><span>
    </span><span><span class="hljs-keyword">public</span></span><span> List&lt;Order&gt; </span><span><span class="hljs-title function_">getAll</span></span><span><span class="hljs-params">()</span></span><span> {
        </span><span><span class="hljs-keyword">return</span></span><span> service.getAllOrders();
    }

    </span><span><span class="hljs-meta">@PutMapping("/{id}")</span></span><span>
    </span><span><span class="hljs-keyword">public</span></span><span> Order </span><span><span class="hljs-title function_">update</span></span><span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span></span></span><span> String id, </span><span><span class="hljs-meta">@RequestBody</span></span><span> Order order) {
        </span><span><span class="hljs-keyword">return</span></span><span> service.updateOrder(id, order);
    }

    </span><span><span class="hljs-meta">@DeleteMapping("/{id}")</span></span><span>
    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">void</span></span><span> </span><span><span class="hljs-title function_">delete</span></span><span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span></span></span><span> String id) {
        service.deleteOrder(id);
    }
}
</span></span></code></div></div></pre>
<hr data-start="6036" data-end="6039">
<h2 data-start="6041" data-end="6079">9Ô∏è‚É£ REAL EXECUTION FLOW (IMPORTANT)</h2>
<pre class="overflow-visible! px-0!" data-start="6081" data-end="6251"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">scss</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span>Client
 ‚Üí API Gateway (JWT validated)
 ‚Üí </span><span><span class="hljs-attribute">Order</span></span><span> Service
    ‚Üí JWT validated again
    ‚Üí Roles extracted
    ‚Üí </span><span><span class="hljs-keyword">@PreAuthorize</span></span><span> evaluated
    ‚Üí Business logic executed
</span></span></code></div></div></pre>
<hr data-start="6253" data-end="6256">
<h2 data-start="6258" data-end="6281">üî¥ FAILURE SCENARIOS</h2>
<div class="TyagGW_tableContainer"><div tabindex="-1" class="group TyagGW_tableWrapper flex w-fit flex-col-reverse"><table data-start="6283" data-end="6445" class="w-fit min-w-(--thread-content-width)"><thead data-start="6283" data-end="6304"><tr data-start="6283" data-end="6304"><th data-start="6283" data-end="6294" data-col-size="sm">Scenario</th><th data-start="6294" data-end="6304" data-col-size="sm">Result</th></tr></thead><tbody data-start="6315" data-end="6445"><tr data-start="6315" data-end="6331"><td data-start="6315" data-end="6324" data-col-size="sm">No JWT</td><td data-start="6324" data-end="6331" data-col-size="sm">401</td></tr><tr data-start="6332" data-end="6353"><td data-start="6332" data-end="6346" data-col-size="sm">Expired JWT</td><td data-start="6346" data-end="6353" data-col-size="sm">401</td></tr><tr data-start="6354" data-end="6388"><td data-start="6354" data-end="6381" data-col-size="sm">User tries others‚Äô order</td><td data-start="6381" data-end="6388" data-col-size="sm">403</td></tr><tr data-start="6389" data-end="6417"><td data-start="6389" data-end="6410" data-col-size="sm">User deletes order</td><td data-col-size="sm" data-start="6410" data-end="6417">403</td></tr><tr data-start="6418" data-end="6445"><td data-start="6418" data-end="6440" data-col-size="sm">Admin deletes order</td><td data-col-size="sm" data-start="6440" data-end="6445">‚úÖ</td></tr></tbody></table><div class="sticky h-0 select-none end-(--thread-content-margin) self-end"><div class="absolute end-0 flex items-end" style="height: 33px;"><span class="" data-state="closed"><button aria-label="Copy table" class="hover:bg-token-bg-tertiary text-token-text-secondary my-1 rounded-sm p-1 transition-opacity group-[:not(:hover):not(:focus-within)]:pointer-events-none group-[:not(:hover):not(:focus-within)]:opacity-0"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" aria-hidden="true" class="icon"><use href="/cdn/assets/sprites-core-btjmrd1b.svg#ce3544" fill="currentColor"></use></svg></button></span></div></div></div></div>
<hr data-start="6447" data-end="6450">
<h2 data-start="6452" data-end="6483">üèÜ INTERVIEW-PERFECT SUMMARY</h2>
<blockquote data-start="6485" data-end="6834">
<p data-start="6487" data-end="6834">‚ÄúThe Order Service uses Spring Security OAuth2 Resource Server for JWT validation, converts Cognito groups into roles, and enforces real-time authorization using <code data-start="6649" data-end="6664">@PreAuthorize</code>. Ownership rules, admin privileges, and internal service access are enforced at the service layer, ensuring zero-trust security and preventing unauthorized data access.‚Äù</p>
</blockquote>
<hr data-start="6836" data-end="6839">
<h3 data-start="6841" data-end="6858">üöÄ Want Next?</h3>
<p data-start="6859" data-end="6865">I can:</p>
<ul data-start="6866" data-end="7037">
<li data-start="6866" data-end="6901">
<p data-start="6868" data-end="6901">Add <strong data-start="6872" data-end="6901">Feign + token propagation</strong></p>
</li>
<li data-start="6902" data-end="6934">
<p data-start="6904" data-end="6934">Add <strong data-start="6908" data-end="6934">Testcontainers + JUnit</strong></p>
</li>
<li data-start="6935" data-end="6961">
<p data-start="6937" data-end="6961">Add <strong data-start="6941" data-end="6961">Kafka/SQS events</strong></p>
</li>
<li data-start="6962" data-end="6994">
<p data-start="6964" data-end="6994">Deploy this to <strong data-start="6979" data-end="6994">AWS ECS/EKS</strong></p>
</li>
<li data-start="6995" data-end="7037">
<p data-start="6997" data-end="7037">Convert this to <strong data-start="7013" data-end="7037">API Gateway + Lambda</strong></p>
</li>
</ul>
<p data-start="7039" data-end="7054" data-is-last-node="" data-is-only-node="">Just tell me üëç</p></div>
`,

async: `
<h1 data-start="4555" data-end="4609">PART C ‚Äî AWS SQS WITH RETRY + DLQ (REAL CLOUD SETUP)</h1>
<h2 data-start="4611" data-end="4625">üéØ Use Case</h2>
<ul data-start="4626" data-end="4700">
<li data-start="4626" data-end="4644">
<p data-start="4628" data-end="4644">Same order event</p>
</li>
<li data-start="4645" data-end="4671">
<p data-start="4647" data-end="4671">Async payment processing</p>
</li>
<li data-start="4672" data-end="4700">
<p data-start="4674" data-end="4700">Managed retry + DLQ by AWS</p>
</li>
</ul>
<hr data-start="4702" data-end="4705">
<h2 data-start="4707" data-end="4728">C1Ô∏è‚É£ AWS SQS Setup</h2>
<p data-start="4729" data-end="4736">Queues:</p>
<ul data-start="4737" data-end="4766">
<li data-start="4737" data-end="4752">
<p data-start="4739" data-end="4752"><code data-start="4739" data-end="4752">order-queue</code></p>
</li>
<li data-start="4753" data-end="4766">
<p data-start="4755" data-end="4766"><code data-start="4755" data-end="4766">order-dlq</code></p>
</li>
</ul>
<p data-start="4768" data-end="4783">Redrive policy:</p>
<ul data-start="4784" data-end="4832">
<li data-start="4784" data-end="4805">
<p data-start="4786" data-end="4805">MaxReceiveCount = 3</p>
</li>
<li data-start="4806" data-end="4832">
<p data-start="4808" data-end="4832">Target DLQ = <code data-start="4821" data-end="4832">order-dlq</code></p>
</li>
</ul>
<hr data-start="4834" data-end="4837">
<h2 data-start="4839" data-end="4857">C2Ô∏è‚É£ Dependency</h2>
<pre class="overflow-visible! px-0!" data-start="4859" data-end="4991"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">xml</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-xml"><span><span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span></span></span><span>&gt;io.awspring.cloud</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span></span></span><span>&gt;spring-cloud-aws-starter-sqs</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span></span></span><span>&gt;
</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span></span></span><span>&gt;
</span></span></code></div></div></pre>
<hr data-start="4993" data-end="4996">
<h2 data-start="4998" data-end="5035">C3Ô∏è‚É£ SQS Publisher (Order Service)</h2>
<pre class="overflow-visible! px-0!" data-start="5037" data-end="5337"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@Component</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">OrderSqsPublisher</span></span><span> {

    </span><span><span class="hljs-keyword">private</span></span><span> </span><span><span class="hljs-keyword">final</span></span><span> SqsTemplate sqsTemplate;

    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-title function_">OrderSqsPublisher</span></span><span><span class="hljs-params">(SqsTemplate sqsTemplate)</span></span><span> {
        </span><span><span class="hljs-built_in">this</span></span><span>.sqsTemplate = sqsTemplate;
    }

    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">void</span></span><span> </span><span><span class="hljs-title function_">sendOrder</span></span><span><span class="hljs-params">(Order order)</span></span><span> {
        sqsTemplate.send(</span><span><span class="hljs-string">"order-queue"</span></span><span>, order);
    }
}
</span></span></code></div></div></pre>
<hr data-start="5339" data-end="5342">
<h2 data-start="5344" data-end="5382">C4Ô∏è‚É£ SQS Consumer (Payment Service)</h2>
<pre class="overflow-visible! px-0!" data-start="5384" data-end="5578"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@SqsListener("order-queue")</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">void</span></span><span> </span><span><span class="hljs-title function_">consume</span></span><span><span class="hljs-params">(Order order)</span></span><span> {
    </span><span><span class="hljs-keyword">if</span></span><span> (order.getQuantity() &lt; </span><span><span class="hljs-number">0</span></span><span>) {
        </span><span><span class="hljs-keyword">throw</span></span><span> </span><span><span class="hljs-keyword">new</span></span><span> </span><span><span class="hljs-title class_">RuntimeException</span></span><span>(</span><span><span class="hljs-string">"Invalid order"</span></span><span>);
    }

    </span><span><span class="hljs-comment">// process payment</span></span><span>
}
</span></span></code></div></div></pre>
<hr data-start="5580" data-end="5583">
<h2 data-start="5585" data-end="5623">C5Ô∏è‚É£ Retry + DLQ Flow (AWS Managed)</h2>
<pre class="overflow-visible! px-0!" data-start="5625" data-end="5723"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">nginx</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span><span class="hljs-attribute">Receive</span></span><span> </span><span><span class="hljs-comment">#1 ‚Üí fail</span></span><span>
Receive </span><span><span class="hljs-comment">#2 ‚Üí fail</span></span><span>
Receive </span><span><span class="hljs-comment">#3 ‚Üí fail</span></span><span>
‚Üí Message moved to DLQ automatically
</span></span></code></div></div></pre>
<p data-start="5725" data-end="5782">‚úî No code needed for retry<br data-start="5751" data-end="5754">
‚úî DLQ fully managed by AWS</p>
<hr data-start="5784" data-end="5787">
`,

kafka: `
<h1 data-start="2423" data-end="2467">PART B ‚Äî EVENT-DRIVEN ARCHITECTURE (KAFKA)</h1>
<h2 data-start="2469" data-end="2483">üéØ Use Case</h2>
<ul data-start="2484" data-end="2569">
<li data-start="2484" data-end="2499">
<p data-start="2486" data-end="2499">Order created</p>
</li>
<li data-start="2500" data-end="2535">
<p data-start="2502" data-end="2535">Payment Service processes payment</p>
</li>
<li data-start="2536" data-end="2569">
<p data-start="2538" data-end="2569">Inventory Service updates stock</p>
</li>
</ul>
<hr data-start="2571" data-end="2574">
<h2 data-start="2576" data-end="2602">B1Ô∏è‚É£ Kafka Dependencies</h2>
<pre class="overflow-visible! px-0!" data-start="2604" data-end="2728"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">xml</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-xml"><span><span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span></span></span><span>&gt;org.springframework.kafka</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span></span></span><span>&gt;spring-kafka</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span></span></span><span>&gt;
</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span></span></span><span>&gt;
</span></span></code></div></div></pre>
<hr data-start="2730" data-end="2733">
<h2 data-start="2735" data-end="2762">B2Ô∏è‚É£ Kafka Configuration</h2>
<pre class="overflow-visible! px-0!" data-start="2764" data-end="3081"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">yaml</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-yaml"><span><span><span class="hljs-attr">spring:</span></span><span>
  </span><span><span class="hljs-attr">kafka:</span></span><span>
    </span><span><span class="hljs-attr">bootstrap-servers:</span></span><span> </span><span><span class="hljs-string">localhost:9092</span></span><span>
    </span><span><span class="hljs-attr">consumer:</span></span><span>
      </span><span><span class="hljs-attr">group-id:</span></span><span> </span><span><span class="hljs-string">order-group</span></span><span>
      </span><span><span class="hljs-attr">auto-offset-reset:</span></span><span> </span><span><span class="hljs-string">earliest</span></span><span>
    </span><span><span class="hljs-attr">producer:</span></span><span>
      </span><span><span class="hljs-attr">key-serializer:</span></span><span> </span><span><span class="hljs-string">org.apache.kafka.common.serialization.StringSerializer</span></span><span>
      </span><span><span class="hljs-attr">value-serializer:</span></span><span> </span><span><span class="hljs-string">org.springframework.kafka.support.serializer.JsonSerializer</span></span><span>
</span></span></code></div></div></pre>
<hr data-start="3083" data-end="3086">
<h2 data-start="3088" data-end="3107">B3Ô∏è‚É£ Order Event</h2>
<pre class="overflow-visible! px-0!" data-start="3109" data-end="3234"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">record</span></span><span> </span><span><span class="hljs-title class_">OrderCreatedEvent</span></span><span><span class="hljs-params">(
    String orderId,
    String userId,
    String product,
    </span></span><span><span class="hljs-type">int</span></span><span> quantity
) {}
</span></span></code></div></div></pre>
<hr data-start="3236" data-end="3239">
<h2 data-start="3241" data-end="3279">B4Ô∏è‚É£ Kafka Producer (Order Service)</h2>
<pre class="overflow-visible! px-0!" data-start="3281" data-end="3846"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@Component</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">OrderEventPublisher</span></span><span> {

    </span><span><span class="hljs-keyword">private</span></span><span> </span><span><span class="hljs-keyword">final</span></span><span> KafkaTemplate&lt;String, Object&gt; kafkaTemplate;

    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-title function_">OrderEventPublisher</span></span><span><span class="hljs-params">(KafkaTemplate&lt;String, Object&gt; kafkaTemplate)</span></span><span> {
        </span><span><span class="hljs-built_in">this</span></span><span>.kafkaTemplate = kafkaTemplate;
    }

    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">void</span></span><span> </span><span><span class="hljs-title function_">publishOrderCreated</span></span><span><span class="hljs-params">(Order order)</span></span><span> {
        kafkaTemplate.send(
            </span><span><span class="hljs-string">"order.created"</span></span><span>,
            </span><span><span class="hljs-keyword">new</span></span><span> </span><span><span class="hljs-title class_">OrderCreatedEvent</span></span><span>(
                order.getId(),
                order.getUserId(),
                order.getProduct(),
                order.getQuantity()
            )
        );
    }
}
</span></span></code></div></div></pre>
<hr data-start="3848" data-end="3851">
<h2 data-start="3853" data-end="3893">B5Ô∏è‚É£ Kafka Consumer (Payment Service)</h2>
<pre class="overflow-visible! px-0!" data-start="3895" data-end="4030"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@KafkaListener(topics = "order.created")</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">void</span></span><span> </span><span><span class="hljs-title function_">handleOrderCreated</span></span><span><span class="hljs-params">(OrderCreatedEvent event)</span></span><span> {
    </span><span><span class="hljs-comment">// process payment</span></span><span>
}
</span></span></code></div></div></pre>
<hr data-start="4032" data-end="4035">
<h2 data-start="4037" data-end="4074">B6Ô∏è‚É£ Kafka Retry + DLQ (IMPORTANT)</h2>
<h3 data-start="4076" data-end="4099">Retry Configuration</h3>
<pre class="overflow-visible! px-0!" data-start="4101" data-end="4415"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@Bean</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> DefaultErrorHandler </span><span><span class="hljs-title function_">errorHandler</span></span><span><span class="hljs-params">(KafkaTemplate&lt;String, Object&gt; template)</span></span><span> {

    </span><span><span class="hljs-type">DeadLetterPublishingRecoverer</span></span><span> </span><span><span class="hljs-variable">recoverer</span></span><span> </span><span><span class="hljs-operator">=</span></span><span>
        </span><span><span class="hljs-keyword">new</span></span><span> </span><span><span class="hljs-title class_">DeadLetterPublishingRecoverer</span></span><span>(template);

    </span><span><span class="hljs-type">FixedBackOff</span></span><span> </span><span><span class="hljs-variable">backOff</span></span><span> </span><span><span class="hljs-operator">=</span></span><span> </span><span><span class="hljs-keyword">new</span></span><span> </span><span><span class="hljs-title class_">FixedBackOff</span></span><span>(</span><span><span class="hljs-number">3000L</span></span><span>, </span><span><span class="hljs-number">3</span></span><span>);

    </span><span><span class="hljs-keyword">return</span></span><span> </span><span><span class="hljs-keyword">new</span></span><span> </span><span><span class="hljs-title class_">DefaultErrorHandler</span></span><span>(recoverer, backOff);
}
</span></span></code></div></div></pre>
<h3 data-start="4417" data-end="4431">Retry Flow</h3>
<pre class="overflow-visible! px-0!" data-start="4432" data-end="4510"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">css</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span>Attempt </span><span><span class="hljs-number">1</span></span><span> ‚Üí fail
Attempt </span><span><span class="hljs-number">2</span></span><span> ‚Üí fail
Attempt </span><span><span class="hljs-number">3</span></span><span> ‚Üí fail
‚Üí Sent </span><span><span class="hljs-selector-tag">to</span></span><span> DLQ topic
</span></span></code></div></div></pre>
<p data-start="4512" data-end="4522">DLQ Topic:</p>
<pre class="overflow-visible! px-0!" data-start="4523" data-end="4548"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">css</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span><span class="hljs-attribute">order</span></span><span><span class="hljs-selector-class">.created</span></span><span><span class="hljs-selector-class">.DLT</span></span><span>
</span></span></code></div></div></pre>
<hr data-start="4550" data-end="4553">
<h1 data-start="4555" data-end="4609">PART C ‚Äî AWS SQS WITH RETRY + DLQ (REAL CLOUD SETUP)</h1>
<h2 data-start="4611" data-end="4625">üéØ Use Case</h2>
<ul data-start="4626" data-end="4700">
<li data-start="4626" data-end="4644">
<p data-start="4628" data-end="4644">Same order event</p>
</li>
<li data-start="4645" data-end="4671">
<p data-start="4647" data-end="4671">Async payment processing</p>
</li>
<li data-start="4672" data-end="4700">
<p data-start="4674" data-end="4700">Managed retry + DLQ by AWS</p>
</li>
</ul>
<hr data-start="4702" data-end="4705">
<h2 data-start="4707" data-end="4728">C1Ô∏è‚É£ AWS SQS Setup</h2>
<p data-start="4729" data-end="4736">Queues:</p>
<ul data-start="4737" data-end="4766">
<li data-start="4737" data-end="4752">
<p data-start="4739" data-end="4752"><code data-start="4739" data-end="4752">order-queue</code></p>
</li>
<li data-start="4753" data-end="4766">
<p data-start="4755" data-end="4766"><code data-start="4755" data-end="4766">order-dlq</code></p>
</li>
</ul>
<p data-start="4768" data-end="4783">Redrive policy:</p>
<ul data-start="4784" data-end="4832">
<li data-start="4784" data-end="4805">
<p data-start="4786" data-end="4805">MaxReceiveCount = 3</p>
</li>
<li data-start="4806" data-end="4832">
<p data-start="4808" data-end="4832">Target DLQ = <code data-start="4821" data-end="4832">order-dlq</code></p>
</li>
</ul>
<hr data-start="4834" data-end="4837">
<h2 data-start="4839" data-end="4857">C2Ô∏è‚É£ Dependency</h2>
<pre class="overflow-visible! px-0!" data-start="4859" data-end="4991"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">xml</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-xml"><span><span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span></span></span><span>&gt;io.awspring.cloud</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span></span></span><span>&gt;
  </span><span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span></span></span><span>&gt;spring-cloud-aws-starter-sqs</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span></span></span><span>&gt;
</span><span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span></span></span><span>&gt;
</span></span></code></div></div></pre>
<hr data-start="4993" data-end="4996">
<h2 data-start="4998" data-end="5035">C3Ô∏è‚É£ SQS Publisher (Order Service)</h2>
<pre class="overflow-visible! px-0!" data-start="5037" data-end="5337"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@Component</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">class</span></span><span> </span><span><span class="hljs-title class_">OrderSqsPublisher</span></span><span> {

    </span><span><span class="hljs-keyword">private</span></span><span> </span><span><span class="hljs-keyword">final</span></span><span> SqsTemplate sqsTemplate;

    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-title function_">OrderSqsPublisher</span></span><span><span class="hljs-params">(SqsTemplate sqsTemplate)</span></span><span> {
        </span><span><span class="hljs-built_in">this</span></span><span>.sqsTemplate = sqsTemplate;
    }

    </span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">void</span></span><span> </span><span><span class="hljs-title function_">sendOrder</span></span><span><span class="hljs-params">(Order order)</span></span><span> {
        sqsTemplate.send(</span><span><span class="hljs-string">"order-queue"</span></span><span>, order);
    }
}
</span></span></code></div></div></pre>
<hr data-start="5339" data-end="5342">
<h2 data-start="5344" data-end="5382">C4Ô∏è‚É£ SQS Consumer (Payment Service)</h2>
<pre class="overflow-visible! px-0!" data-start="5384" data-end="5578"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">java</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre! language-java"><span><span><span class="hljs-meta">@SqsListener("order-queue")</span></span><span>
</span><span><span class="hljs-keyword">public</span></span><span> </span><span><span class="hljs-keyword">void</span></span><span> </span><span><span class="hljs-title function_">consume</span></span><span><span class="hljs-params">(Order order)</span></span><span> {
    </span><span><span class="hljs-keyword">if</span></span><span> (order.getQuantity() &lt; </span><span><span class="hljs-number">0</span></span><span>) {
        </span><span><span class="hljs-keyword">throw</span></span><span> </span><span><span class="hljs-keyword">new</span></span><span> </span><span><span class="hljs-title class_">RuntimeException</span></span><span>(</span><span><span class="hljs-string">"Invalid order"</span></span><span>);
    }

    </span><span><span class="hljs-comment">// process payment</span></span><span>
}
</span></span></code></div></div></pre>
<hr data-start="5580" data-end="5583">
<h2 data-start="5585" data-end="5623">C5Ô∏è‚É£ Retry + DLQ Flow (AWS Managed)</h2>
<pre class="overflow-visible! px-0!" data-start="5625" data-end="5723"><div class="contain-inline-size rounded-2xl corner-superellipse/1.1 relative bg-token-sidebar-surface-primary"><div class="flex items-center text-token-text-secondary px-4 py-2 text-xs font-sans justify-between h-9 bg-token-sidebar-surface-primary select-none rounded-t-2xl corner-t-superellipse/1.1">nginx</div><div class="@w-xl/main:top-9 sticky top-[calc(--spacing(9)+var(--header-height))]"><div class="absolute end-0 bottom-0 flex h-9 items-center pe-2"><div class="bg-token-bg-elevated-secondary text-token-text-secondary flex items-center gap-4 rounded-sm px-2 font-sans text-xs"></div></div></div><div class="overflow-y-auto p-4" dir="ltr"><code class="whitespace-pre!"><span><span><span class="hljs-attribute">Receive</span></span><span> </span><span><span class="hljs-comment">#1 ‚Üí fail</span></span><span>
Receive </span><span><span class="hljs-comment">#2 ‚Üí fail</span></span><span>
Receive </span><span><span class="hljs-comment">#3 ‚Üí fail</span></span><span>
‚Üí Message moved to DLQ automatically
</span></span></code></div></div></pre>
<p data-start="5725" data-end="5782">‚úî No code needed for retry<br data-start="5751" data-end="5754">
‚úî DLQ fully managed by AWS</p>
`,

testing: `
<div style="font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto; color:#111827; line-height:1.6;">

  <!-- Header -->
  <h2 style="margin:0 0 6px 0;">üß™ <b>JUnit &amp; Mockito ‚Äî IN-DEPTH</b> (Real-World)</h2>
  
	   
  <h3>üß† Mental Model (VERY IMPORTANT)</h3>
	<pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
	JUnit  ‚Üí test framework
	Mockito ‚Üí fake dependencies
	Spring ‚Üí NOT involved in unit tests
	</pre>
	
  <h3>üéØ Interview-Perfect Summary</h3>

	<p>‚ÄúJUnit is used to validate business logic and edge cases, while Mockito isolates dependencies like repositories, Feign clients, and event publishers. Security annotations are tested at controller level using MockMvc. This layered testing approach ensures correctness, resilience, and zero-trust security without slow integration tests.‚Äù</p>	
	
  <p style="margin:0 0 14px 0; color:#374151;">What We Are Testing (Context)</p>

  <ul style="margin:0 0 10px 20px;">
    <li>Security (<code>@PreAuthorize</code>)</li>
    <li>Business rules (stock, ownership)</li>
    <li>DB persistence</li>
    <li>Feign calls</li>
    <li>Event publishing</li>
  </ul>

  <p style="margin:6px 0;">üëâ We do <b>NOT</b> test Spring itself.</p>
  <p style="margin:0 0 18px 0;">üëâ We do test <b>our logic and integrations</b>.</p>

  <hr style="border:none;border-top:1px solid #e5e7eb;margin:20px 0;">

  <!-- Section 1 -->
  <h3><span style="background:#2563eb;color:#fff;padding:2px 8px;border-radius:6px;">1</span>
    Types of Tests (Very Important)</h3>

  <table style="width:100%;border-collapse:collapse;margin-top:10px;">
    <thead>
      <tr style="background:#f9fafb;">
        <th style="text-align:left;padding:10px;border:1px solid #e5e7eb;">Test Type</th>
        <th style="text-align:left;padding:10px;border:1px solid #e5e7eb;">Purpose</th>
        <th style="text-align:left;padding:10px;border:1px solid #e5e7eb;">Tools</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="padding:10px;border:1px solid #e5e7eb;">Unit Test</td>
        <td style="padding:10px;border:1px solid #e5e7eb;">Test one class in isolation</td>
        <td style="padding:10px;border:1px solid #e5e7eb;">JUnit + Mockito</td>
      </tr>
      <tr>
        <td style="padding:10px;border:1px solid #e5e7eb;">Slice Test</td>
        <td style="padding:10px;border:1px solid #e5e7eb;">Test Spring layer</td>
        <td style="padding:10px;border:1px solid #e5e7eb;"><code>@WebMvcTest</code>, <code>@DataJpaTest</code></td>
      </tr>
      <tr>
        <td style="padding:10px;border:1px solid #e5e7eb;">Integration Test</td>
        <td style="padding:10px;border:1px solid #e5e7eb;">Test full flow</td>
        <td style="padding:10px;border:1px solid #e5e7eb;"><code>@SpringBootTest</code></td>
      </tr>
      <tr>
        <td style="padding:10px;border:1px solid #e5e7eb;">Contract Test</td>
        <td style="padding:10px;border:1px solid #e5e7eb;">Inter-service agreement</td>
        <td style="padding:10px;border:1px solid #e5e7eb;">Spring Cloud Contract</td>
      </tr>
    </tbody>
  </table>

  <p style="margin:14px 0;">We will focus on <b>Unit + Controller + Security + Feign + Events</b>.</p>

  <hr style="border:none;border-top:1px solid #e5e7eb;margin:20px 0;">

  <!-- Section 2 -->
  <h3><span style="background:#2563eb;color:#fff;padding:2px 8px;border-radius:6px;">2</span>
    Unit Testing Service Layer (MOST IMPORTANT)</h3>

  <p><b>Class Under Test</b></p>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
OrderService
  </pre>

  <p><b>Dependencies (to mock)</b></p>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
OrderRepository
ProductClient
OrderEventPublisher
  </pre>

  <p>‚úÖ <b>Basic Unit Test Setup</b></p>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
@ExtendWith(MockitoExtension.class)
class OrderServiceTest {

  @InjectMocks
  private OrderService orderService;

  @Mock
  private OrderRepository repository;

  @Mock
  private ProductClient productClient;

  @Mock
  private OrderEventPublisher eventPublisher;

  @Mock
  private Authentication authentication;
}
  </pre>

  <p style="margin-top:10px;">‚úî Business logic isolated<br>
     ‚úî External dependencies mocked</p>

  <hr style="border:none;border-top:1px solid #e5e7eb;margin:20px 0;">

  <h3 style="margin:0 0 10px 0;">
    ‚úÖ <b>Test: Create Order ‚Äî SUCCESS CASE</b>
  </h3>
  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
@Test
void shouldCreateOrderWhenStockAvailable() {

  Order order = new Order();
  order.setProduct("P100");
  order.setQuantity(1);

  when(authentication.getName()).thenReturn("user123");
  when(productClient.checkStock("P100"))
      .thenReturn(new StockResponse(true));

  when(repository.save(any(Order.class)))
      .thenAnswer(inv -> inv.getArgument(0));

  Order saved = orderService.createOrder(order, authentication);

  assertEquals("user123", saved.getUserId());
  assertEquals("CREATED", saved.getStatus());

  verify(repository).save(any(Order.class));
  verify(eventPublisher).publishOrderCreated(saved);
}
  </pre>

  <p>‚úî Business rule applied<br>
     ‚úî User ID from JWT<br>
     ‚úî Order saved<br>
     ‚úî Event published</p>

  <h3 style="margin:0 0 10px 0;">
    ‚ùå <b>Test: Create Order ‚Äì OUT OF STOCK</b>
  </h3>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
@Test
void shouldFailWhenStockNotAvailable() {

    Order order = new Order();
    order.setProduct("P200");

    when(productClient.checkStock("P200"))
        .thenReturn(new StockResponse(false));

    RuntimeException ex = assertThrows(
        RuntimeException.class,
        () -> orderService.createOrder(order, authentication)
    );

    assertEquals("Out of stock", ex.getMessage());

    verify(repository, never()).save(any());
    verify(eventPublisher, never()).publishOrderCreated(any());
}
  </pre>

  <p>‚úî No DB write<br>
     ‚úî No event published<br>
     ‚úî Correct failure behavior</p>
</div>
  <!-- Section 3 -->
  <h3><span style="background:#2563eb;color:#fff;padding:2px 8px;border-radius:6px;">3</span>
    Verifying Interactions (Mockito Power)</h3>

  <p><b>Verify call count</b></p>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
	verify(productClient, times(1)).checkStock("P100");
  </pre>
  
  <p><b>Verify order of execution</b></p>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
	InOrder inOrder = inOrder(repository, eventPublisher);

	inOrder.verify(repository).save(any());
	inOrder.verify(eventPublisher).publishOrderCreated(any());
  </pre>  
  
  <!-- Section 4 -->
  <h3><span style="background:#2563eb;color:#fff;padding:2px 8px;border-radius:6px;">4</span>
    Mocking Feign Exceptions (Real Production Case)</h3>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
@Test
void shouldFailWhenProductServiceDown() {

    when(productClient.checkStock(any()))
        .thenThrow(new RuntimeException("Service unavailable"));

    assertThrows(
        RuntimeException.class,
        () -> orderService.createOrder(new Order(), authentication)
    );
}
  </pre>
  <p>‚úî Simulates downstream failure<br>
	 ‚úî Tests resilience logic</p>
	 
  <!-- Section 5 -->
  <h3><span style="background:#2563eb;color:#fff;padding:2px 8px;border-radius:6px;">5</span>
    Testing Security (@PreAuthorize) ‚Äî IMPORTANT</h3>
	
	‚ùå <b>Unit tests DO NOT enforce security</b><br><br>

	Security is enforced by Spring context, not plain Mockito tests.<br><br>

	So we test security at Controller level.

  <!-- Section 6 -->
  <h3><span style="background:#2563eb;color:#fff;padding:2px 8px;border-radius:6px;">6</span>
    Controller + Security Test (@WebMvcTest)</h3>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
	@WebMvcTest(OrderController.class)
	@Import(SecurityConfig.class)
	class OrderControllerSecurityTest {

		@Autowired
		private MockMvc mockMvc;

		@MockBean
		private OrderService orderService;
	}
  </pre>

  <h3 style="margin:0 0 10px 0;">
    ‚ùå <b>Test: Unauthorized (No JWT)</b>
  </h3>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
	@Test
	void shouldReturn401WhenNoToken() throws Exception {

		mockMvc.perform(post("/orders"))
			   .andExpect(status().isUnauthorized());
	}
  </pre>
  
  <h3 style="margin:0 0 10px 0;">
    ‚ùå <b>Test: Forbidden (Wrong Role)</b>
  </h3>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
	@Test
	@WithMockUser(roles = "ADMIN")
	void shouldReturn403WhenRoleInvalid() throws Exception {

		mockMvc.perform(post("/orders"))
			   .andExpect(status().isForbidden());
	}
  </pre> 
  
  <h3 style="margin:0 0 10px 0;">
    ‚úÖ <b>est: Authorized USER</b>
  </h3>
  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
	@Test
	@WithMockUser(roles = "USER")
	void shouldAllowUserToCreateOrder() throws Exception {

		mockMvc.perform(post("/orders")
			   .contentType(MediaType.APPLICATION_JSON)
			   .content("{}"))
			   .andExpect(status().isOk());
	}
  </pre>  
  
  <!-- Section 7 -->
  <h3><span style="background:#2563eb;color:#fff;padding:2px 8px;border-radius:6px;">7</span>
    Testing Ownership Rules (@PreAuthorize + DB)</h3>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
	@Test
	@WithMockUser(username = "user123", roles = "USER")
	void shouldAllowOwnerToViewOrder() throws Exception {

		when(orderSecurity.isOwner(eq("ORD1"), any()))
			.thenReturn(true);

		mockMvc.perform(get("/orders/ORD1"))
			   .andExpect(status().isOk());
	}
  </pre>

  <!-- Section 8 -->
  <h3><span style="background:#2563eb;color:#fff;padding:2px 8px;border-radius:6px;">8</span>
    Testing Kafka / SQS Event Publishing</h3>

  <p><b>Kafka Publisher Test</b></p>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
	@Test
	void shouldPublishOrderCreatedEvent() {

		Order order = new Order();
		order.setId("ORD123");

		orderEventPublisher.publishOrderCreated(order);

		verify(kafkaTemplate)
			.send(eq("order.created"), any(OrderCreatedEvent.class));
	}

  </pre>
  
  <p><b>SQS Publisher Test</b></p>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
	@Test
	void shouldSendMessageToQueue() {

		Order order = new Order();

		sqsPublisher.sendOrder(order);

		verify(sqsTemplate)
			.send(eq("order-queue"), eq(order));
	}

  </pre>  

  <!-- Section 9 -->
  <h3><span style="background:#2563eb;color:#fff;padding:2px 8px;border-radius:6px;">9</span>
    Common Mockito Mistakes (INTERVIEW FAVORITES)</h3>  

  ‚ùå <b>Stubbing what you don‚Äôt use</b><br><br>

  <pre style="background:#020617;color:#9fe0ff;padding:16px;border-radius:10px;font-family:JetBrains Mono,monospace;">
	when(repo.findAll()).thenReturn(...)
  </pre>  
  
  ‚ùå <b>Verifying Spring internals</b><br><br>  
  ‚ùå <b>Using real DB in unit tests</b><br><br>
  ‚ùå <b>Testing private methods</b><br><br>  
  
  <h3>üî• Mockito Best Practices</h3>

	<p>‚úÖ Mock only external dependencies<br>
	   ‚úÖ Use any() wisely<br>
	   ‚úÖ Prefer behavior testing over state<br>
	   ‚úÖ Name tests clearly<br>
	   ‚úÖ One assertion group per test</p>

`,

cognito: `
<h2>8. Cognito Password Validation</h2>

<ul>
  <li>Minimum length enforcement</li>
  <li>Uppercase & lowercase characters</li>
  <li>Numbers and special characters</li>
  <li>Password history and expiration</li>
  <li>MFA support</li>
</ul>

<p>
Passwords are never handled by backend services.
Cognito fully manages credential security.
</p>
`,

summary: `
<h2>9. Final Summary</h2>

<ul>
  <li>OAuth2 authentication using Cognito</li>
  <li>JWT validated at Gateway and service layer</li>
  <li>Zero-trust security model</li>
  <li>Synchronous & asynchronous communication</li>
  <li>Kafka-based event streaming</li>
  <li>Production-grade testing and observability</li>
</ul>

<p><strong>
This architecture is scalable, secure, and interview-ready.
</strong></p>
`
};

function load(key) {
  document.getElementById("content").innerHTML = data[key];
  document.querySelectorAll(".menu li").forEach(li => li.classList.remove("active"));
  event.target.classList.add("active");
}

load("arch");
</script>

</body>
</html>
